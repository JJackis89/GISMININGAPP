var Or=Object.getPrototypeOf;var xr=Reflect.get;var yt=(r,e,t)=>{if(!e.has(r))throw TypeError("Cannot "+t)};var f=(r,e,t)=>(yt(r,e,"read from private field"),t?t.call(r):e.get(r)),A=(r,e,t)=>{if(e.has(r))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(r):e.set(r,t)},S=(r,e,t,s)=>(yt(r,e,"write to private field"),s?s.call(r,t):e.set(r,t),t);var F=(r,e,t)=>(yt(r,e,"access private method"),t),ls=(r,e,t)=>xr(Or(r),t,e);import{bE as Rr,ic as Te,bG as it,bJ as ot,am as xt,cS as Rt,ge as Lr,cv as nt,fS as Dr,ac as Lt,fI as qs,k4 as cs,kw as Nr,c6 as Mr,jx as jr,c8 as Gt,ab as Hr,kx as qr,aD as zr,R as Br,ky as Vr,kz as Fr,io as hs,gV as ds,kA as Wr,kB as Ye,kC as Jr,cs as Gr,r as g,m,dP as Kr,a as Fe,_ as $e,l as zs,kD as Bs,bA as wt,aI as Je,bo as ke,p as T,g3 as Qr,c$ as W,ek as Z,H as q,kE as Ge,kF as St,dN as us,kG as Yr,gu as ps,k as At,fP as Xr,jw as Zr,cT as ei,a7 as Ke,kH as ti}from"./index-8ee34b61.js";import{t as Vs}from"./sanitizerUtils-d00433fc.js";const Fs=()=>xt.getLogger("esri.intl.substitute");function si(r,e,t={}){const{format:s={}}=t;return Rr(r,i=>ri(i,e,s))}function ri(r,e,t){let s,i;const o=r.indexOf(":");if(o===-1?s=r.trim():(s=r.slice(0,o).trim(),i=r.slice(o+1).trim()),!s)return"";const n=Te(s,e);if(n==null)return"";const l=(i?t?.[i]:null)??t?.[s];return l?ii(n,l):i?oi(n,i):Kt(n)}function ii(r,e){switch(e.type){case"date":return ot(r,e.intlOptions);case"number":return it(r,e.intlOptions);default:return Fs().warn("missing format descriptor for key {key}"),Kt(r)}}function oi(r,e){switch(e.toLowerCase()){case"dateformat":return ot(r);case"numberformat":return it(r);default:return Fs().warn(`inline format is unsupported since 4.12: ${e}`),/^(dateformat|datestring)/i.test(e)?ot(r):/^numberformat/i.test(e)?it(r):Kt(r)}}function Kt(r){switch(typeof r){case"string":return r;case"number":return it(r);case"boolean":return""+r;default:return r instanceof Date?ot(r):""}}function ni(r){return typeof r=="string"?document.getElementById(r):r??null}const Ws="http://www.w3.org/",ft=`${Ws}2000/svg`,Js=`${Ws}1999/xlink`;let fs=[],Qt=(r,e)=>{let t={};return Object.keys(r).forEach(s=>{t[s]=r[s]}),e&&Object.keys(e).forEach(s=>{t[s]=e[s]}),t},Yt=(r,e)=>r.vnodeSelector===e.vnodeSelector&&(r.properties&&e.properties?r.properties.key===e.properties.key&&r.properties.bind===e.properties.bind:!r.properties&&!e.properties),Gs=r=>{if(typeof r!="string")throw new Error("Style values must be strings")},ai=(r,e,t)=>{if(e.vnodeSelector!==""){for(let s=t;s<r.length;s++)if(Yt(r[s],e))return s}return-1},bt=(r,e,t,s)=>{let i=r[e];if(i.vnodeSelector==="")return;let o=i.properties;if(!(o&&(o.key===void 0?o.bind:o.key))){for(let n=0;n<r.length;n++)if(n!==e){let l=r[n];if(Yt(l,i))throw new Error(`${t.vnodeSelector} had a ${i.vnodeSelector} child ${s==="added"?s:"removed"}, but there is now more than one. You must add unique key properties to make them distinguishable.`)}}},li=r=>{if(r.properties){let e=r.properties.enterAnimation;e&&e(r.domNode,r.properties)}},Dt=[],Nt=!1,Ks=r=>{(r.children||[]).forEach(Ks),r.properties&&r.properties.afterRemoved&&r.properties.afterRemoved.apply(r.properties.bind||r.properties,[r.domNode])},gs=()=>{Nt=!1,Dt.forEach(Ks),Dt.length=0},ms=r=>{Dt.push(r),Nt||(Nt=!0,typeof window<"u"&&"requestIdleCallback"in window?window.requestIdleCallback(gs,{timeout:16}):setTimeout(gs,16))},vs=r=>{let e=r.domNode;if(r.properties){let t=r.properties.exitAnimation;if(t)return e.style.pointerEvents="none",void t(e,()=>{e.parentNode&&(e.parentNode.removeChild(e),ms(r))},r.properties)}e.parentNode&&(e.parentNode.removeChild(e),ms(r))},ci=(r,e,t)=>{if(!e)return;let s=t.eventHandlerInterceptor,i=Object.keys(e),o=i.length;for(let n=0;n<o;n++){let l=i[n],a=e[l];if(l==="className")throw new Error('Property "className" is not supported, use "class".');if(l==="class")jt(r,a,!0);else if(l==="classes"){let c=Object.keys(a),u=c.length;for(let h=0;h<u;h++){let d=c[h];a[d]&&r.classList.add(d)}}else if(l==="styles"){let c=Object.keys(a),u=c.length;for(let h=0;h<u;h++){let d=c[h],p=a[d];p&&(Gs(p),t.styleApplyer(r,d,p))}}else if(l!=="key"&&a!=null){let c=typeof a;c==="function"?(l.lastIndexOf("on",0)===0&&(s&&(a=s(l,a,r,e)),l==="oninput"&&function(){let u=a;a=function(h){u.apply(this,[h]),h.target["oninput-value"]=h.target.value}}()),r[l]=a):t.namespace===ft?l==="href"?r.setAttributeNS(Js,l,a):r.setAttribute(l,a):c==="string"&&l!=="value"?l==="innerHTML"?r[l]=Vs.sanitize(a):Mt(r)&&l in r?r[l]=a:r.setAttribute(l,a):r[l]=a}}};function Mt(r){if(!(r instanceof Element&&r.tagName.includes("-")))return!1;const e=window.customElements.get(r.tagName.toLowerCase());return!!e&&r instanceof e}let at,hi=(r,e,t)=>{if(e)for(let s of e)le(s,r,void 0,t)},Qs=(r,e,t)=>{hi(r,e.children,t),e.text&&(r.textContent=e.text),ci(r,e.properties,t),e.properties&&e.properties.afterCreate&&e.properties.afterCreate.apply(e.properties.bind||e.properties,[r,t,e.vnodeSelector,e.properties,e.children])},le=(r,e,t,s)=>{let i,o=0,n=r.vnodeSelector,l=e.ownerDocument;if(n==="")i=r.domNode=l.createTextNode(r.text),t!==void 0?e.insertBefore(i,t):e.appendChild(i);else{for(let a=0;a<=n.length;++a){let c=n.charAt(a);if(a===n.length||c==="."||c==="#"){let u=n.charAt(o-1),h=n.slice(o,a);u==="."?i.classList.add(h):u==="#"?i.id=h:(h==="svg"&&(s=Qt(s,{namespace:ft})),s.namespace!==void 0?i=r.domNode=l.createElementNS(s.namespace,h):(i=r.domNode=r.domNode||l.createElement(h),h==="input"&&r.properties&&r.properties.type!==void 0&&i.setAttribute("type",r.properties.type)),t!==void 0?e.insertBefore(i,t):i.parentNode!==e&&e.appendChild(i)),o=a+1}}Qs(i,r,s)}},jt=(r,e,t)=>{e&&e.split(" ").forEach(s=>{s&&r.classList.toggle(s,t)})},di=(r,e,t,s)=>{if(!t)return;let i=!1,o=Object.keys(t),n=o.length;for(let l=0;l<n;l++){let a=o[l],c=t[a],u=e[a];if(a==="class")u!==c&&(jt(r,u,!1),jt(r,c,!0));else if(a==="classes"){let h=r.classList,d=Object.keys(c),p=d.length;for(let v=0;v<p;v++){let _=d[v],w=!!c[_];w!==!!u[_]&&(i=!0,w?h.add(_):h.remove(_))}}else if(a==="styles"){let h=Object.keys(c),d=h.length;for(let p=0;p<d;p++){let v=h[p],_=c[v];_!==u[v]&&(i=!0,_?(Gs(_),s.styleApplyer(r,v,_)):s.styleApplyer(r,v,""))}}else if(c||typeof u!="string"||(c=""),a!=="value"||Mt(r)){if(c!==u){let h=typeof c;h==="function"&&s.eventHandlerInterceptor||(s.namespace===ft?a==="href"?r.setAttributeNS(Js,a,c):r.setAttribute(a,c):h==="string"?a==="innerHTML"?r[a]=Vs.sanitize(c):a==="role"&&c===""?r.removeAttribute(a):Mt(r)&&a in r?r[a]=c:r.setAttribute(a,c):r[a]!==c&&(r[a]=c),i=!0)}}else{let h=r[a];h!==c&&(r["oninput-value"]?h===r["oninput-value"]:c!==u)&&(r[a]=c,r["oninput-value"]=void 0),c!==u&&(i=!0)}}return i},ui=(r,e,t,s,i)=>{if(t===s)return!1;s=s||fs;let o,n=(t=t||fs).length,l=s.length,a=0,c=0,u=!1;for(;c<l;){let h=a<n?t[a]:void 0,d=s[c];if(h!==void 0&&Yt(h,d))u=at(h,d,i)||u,a++;else{let p=ai(t,d,a+1);if(p>=0){for(o=a;o<p;o++)vs(t[o]),bt(t,o,r,"removed");u=at(t[p],d,i)||u,a=p+1}else le(d,e,a<n?t[a].domNode:void 0,i),li(d),bt(s,c,r,"added")}c++}if(n>a)for(o=a;o<n;o++)vs(t[o]),bt(t,o,r,"removed");return u};at=(r,e,t)=>{let s=r.domNode,i=!1;if(r===e)return!1;let o=!1;if(e.vnodeSelector===""){if(e.text!==r.text){let n=s.ownerDocument.createTextNode(e.text);return s.parentNode.replaceChild(n,s),e.domNode=n,i=!0,i}e.domNode=s}else e.vnodeSelector.lastIndexOf("svg",0)===0&&(t=Qt(t,{namespace:ft})),r.text!==e.text&&(o=!0,e.text===void 0?s.removeChild(s.firstChild):s.textContent=e.text),e.domNode=s,o=ui(e,s,r.children,e.children,t)||o,o=di(s,r.properties,e.properties,t)||o,e.properties&&e.properties.afterUpdate&&e.properties.afterUpdate.apply(e.properties.bind||e.properties,[s,t,e.vnodeSelector,e.properties,e.children]);return o&&e.properties&&e.properties.updateAnimation&&e.properties.updateAnimation(s,e.properties,r.properties),i};let Ie=(r,e)=>({getLastRender:()=>r,update:t=>{if(r.vnodeSelector!==t.vnodeSelector)throw new Error("The selector for the root VNode may not be changed. (consider using dom.merge and add one extra level to the virtual DOM)");let s=r;r=t,at(s,t,e)},domNode:r.domNode});const pi={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(r,e,t)=>{e.charAt(0)==="-"?r.style.setProperty(e,t):r.style[e]=t}};let Ce=r=>Qt(pi,r),Qe={create:(r,e)=>(e=Ce(e),le(r,document.createElement("div"),void 0,e),Ie(r,e)),append:(r,e,t)=>(t=Ce(t),le(e,r,void 0,t),Ie(e,t)),insertBefore:(r,e,t)=>(t=Ce(t),le(e,r.parentNode,r,t),Ie(e,t)),merge:(r,e,t)=>(t=Ce(t),e.domNode=r,Qs(r,e,t),Ie(e,t)),replace:(r,e,t)=>(t=Ce(t),le(e,r.parentNode,r,t),r.parentNode.removeChild(r),Ie(e,t))};const fi={handleInterceptedEvent:(r,e,t,s)=>(r.scheduleRender(),e.properties[`on${s.type}`].apply(e.properties.bind||t,[s]))},gi={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(r,e,t)=>{e.charAt(0)==="-"?r.style.setProperty(e,t):r.style[e]=t}},mi=r=>({...gi,...r}),vi=(r,e)=>{const t=[];for(;r&&r!==e;)t.push(r),r=r.parentNode;return t},_i=(r,e)=>r.find(e),_s=(r,e,t=!1)=>{let s=r;return e.forEach((i,o)=>{const n=s?.children?_i(s.children,l=>l.domNode===i):void 0;t&&!n&&o!==e.length-1||(s=n)}),s},yi=r=>{let e;const t={...fi,...r},s=mi(t),i=s.performanceLogger;let o,n=!0,l=!1;const a=[],c=[],u=(d,p,v)=>{let _;s.eventHandlerInterceptor=(I,y,$,b)=>function(D){let We;i("domEvent",D);const _t=vi(D.currentTarget,_.domNode),Pr=_t.some(be=>customElements.get(be?.tagName?.toLowerCase()));if(D.eventPhase===Event.CAPTURING_PHASE||!Pr)_t.reverse(),We=_s(_.getLastRender(),_t);else{const be=D.composedPath(),Er=be.slice(be.indexOf(D.currentTarget),be.indexOf(_.domNode)).reverse();We=_s(_.getLastRender(),Er,!0)}let as;return We&&(as=t.handleInterceptedEvent(e,We,this,D)),i("domEventProcessed",D),as},t.postProcessProjectionOptions?.(s);const w=v();_=d(p,w,s),s.eventHandlerInterceptor=void 0,a.push(_),c.push(v),t.afterFirstVNodeRendered&&t.afterFirstVNodeRendered(_,w)};let h=()=>{if(o=void 0,n){n=!1,i("renderStart",void 0);for(let d=0;d<a.length;d++){const p=c[d]();i("rendered",void 0);try{a[d].update(p)}catch(v){console.error(v)}i("patched",void 0)}i("renderDone",void 0),n=!0}};return t.modifyDoRenderImplementation&&(h=t.modifyDoRenderImplementation(h,a,c)),e={renderNow:h,scheduleRender:()=>{o||l||(o=requestAnimationFrame(h))},stop:()=>{o&&(cancelAnimationFrame(o),o=void 0),l=!0},resume:()=>{l=!1,n=!0,e.scheduleRender()},append:(d,p)=>{u(Qe.append,d,p)},insertBefore:(d,p)=>{u(Qe.insertBefore,d,p)},merge:(d,p)=>{u(Qe.merge,d,p)},replace:(d,p)=>{u(Qe.replace,d,p)},detach:d=>{for(let p=0;p<c.length;p++)if(c[p]===d)return c.splice(p,1),a.splice(p,1)[0];throw new Error("renderFunction was not found")}},e};class Ne{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}const wi=(r,e)=>{let t=r;for(;t;){if(t===e)return!0;if(!t.parentNode)return!1;t.parentNode instanceof ShadowRoot?t=t.parentNode.host:t=t.parentNode}return!1},Si=(r,e,t)=>{const s=Ai(e).subscribe;return s(i=>{i.some(n=>wi(r,n.target))&&t()})},$t={},Ai=r=>{const e=r.join(","),t=$t[e];if(t!==void 0)return t;const s=new Set,i=new MutationObserver(n=>s.forEach(l=>l(n)));globalThis.document&&i.observe(document.documentElement,{attributes:!0,attributeFilter:r,subtree:!0});const o={subscribe:n=>(s.add(n),()=>{s.delete(n),s.size===0&&(i.disconnect(),$t[e]=void 0)})};return $t[e]=o,o},bi=(r,e)=>{let t=r;for(;t;){const s=t.closest?.(e);if(s)return s;const i=t.getRootNode?.();if(i===globalThis.document)return null;t=i.host}return null},$i=(r,e,t)=>bi(r,`[${e}]`)?.getAttribute(e)??t,C=(r,e,...t)=>{try{return r?.call(e,...t)}catch(s){console.error(s,r)}},Ht=async(r,e,...t)=>{try{return await r?.call(e,...t)}catch(s){console.error(s,r)}},ki="ar,bg,bs,ca,cs,da,de,el,en,es,et,fi,fr,he,hr,hu,id,it,ja,ko,lt,lv,nl,nb,no,pl,pt-BR,pt-PT,ro,ru,sk,sl,sr,sv,th,tr,uk,vi,zh-CN,zh-HK,zh-TW".split(","),Ii=new Set(ki),lt="en",Ci={pt:"pt-PT",nb:"no",nn:"no",zh:"zh-CN"},Ui=async(r,e,t="")=>{const s=`${e}/${t}`,i=`${s}${r}.json`;return kt[i]??(kt[i]=Ys(r,s)),await kt[i]},kt={},Ys=async(r,e)=>{const t=`${e}${r}.json`;try{const s=await fetch(t);if(s.ok)return await s.json()}catch(s){return console.error(s),{}}return r===lt?{}:await Ys(lt,e)},Ti=r=>{const e=$i(r,"lang",globalThis.navigator?.language||lt);return{lang:e,t9nLocale:Xs(e)}},Xs=r=>{const[e,t]=r.split("-"),s=e.toLowerCase();let i=s;return t&&(i=`${s}-${t.toUpperCase()}`),i=Ci[i]??i,Ii.has(i)?i:t?Xs(s):lt},mn=(r,e,t,s)=>{let i;const o=()=>Pi(r,e(),s).then(n=>{(i?.lang!==n.lang||i.t9nLocale!==n.t9nLocale||i.t9nStrings!==n.t9nStrings)&&t(n),i=n}).catch(console.error);return queueMicrotask(o),Si(r,["lang"],o)},Pi=async(r,e,t=r.localName.split("-").slice(1).join("-"))=>{const{lang:s,t9nLocale:i}=Ti(r),o=`${e}/${t}/t9n`,l=t===null?{}:await Ui(i,o,"messages.");return{lang:s,t9nLocale:i,t9nStrings:l}},Ei=r=>r.replace(Oi,(e,t)=>`${t===0?"":"-"}${e.toLowerCase()}`),Oi=/[A-Z]+(?![a-z])|[A-Z]/gu,xi=(r,e)=>{const t=e>Ri?Li:e/Di;let s=0;const i=setInterval(()=>{s+=t,s>=e&&(clearInterval(i),r())},t);return i},Ri=4e3,Li=2e3,Di=4;/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const Xe=globalThis,Xt=Xe.ShadowRoot&&(Xe.ShadyCSS===void 0||Xe.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,Zt=Symbol(),ys=new WeakMap;let Zs=class{constructor(e,t,s){if(this._$cssResult$=!0,s!==Zt)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=e,this.t=t}get styleSheet(){let e=this.o;const t=this.t;if(Xt&&e===void 0){const s=t!==void 0&&t.length===1;s&&(e=ys.get(t)),e===void 0&&((this.o=e=new CSSStyleSheet).replaceSync(this.cssText),s&&ys.set(t,e))}return e}toString(){return this.cssText}};const Ni=r=>new Zs(typeof r=="string"?r:r+"",void 0,Zt),_n=(r,...e)=>{const t=r.length===1?r[0]:e.reduce((s,i,o)=>s+(n=>{if(n._$cssResult$===!0)return n.cssText;if(typeof n=="number")return n;throw Error("Value passed to 'css' function must be a 'css' function result: "+n+". Use 'unsafeCSS' to pass non-literal values, but take care to ensure page security.")})(i)+r[o+1],r[0]);return new Zs(t,r,Zt)},Mi=(r,e)=>{if(Xt)r.adoptedStyleSheets=e.map(t=>t instanceof CSSStyleSheet?t:t.styleSheet);else for(const t of e){const s=document.createElement("style"),i=Xe.litNonce;i!==void 0&&s.setAttribute("nonce",i),s.textContent=t.cssText,r.appendChild(s)}},ws=Xt?r=>r:r=>r instanceof CSSStyleSheet?(e=>{let t="";for(const s of e.cssRules)t+=s.cssText;return Ni(t)})(r):r;/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const{is:ji,defineProperty:Hi,getOwnPropertyDescriptor:qi,getOwnPropertyNames:zi,getOwnPropertySymbols:Bi,getPrototypeOf:Vi}=Object,K=globalThis,Ss=K.trustedTypes,Fi=Ss?Ss.emptyScript:"",Wi=K.reactiveElementPolyfillSupport,Oe=(r,e)=>r,qt={toAttribute(r,e){switch(e){case Boolean:r=r?Fi:null;break;case Object:case Array:r=r==null?r:JSON.stringify(r)}return r},fromAttribute(r,e){let t=r;switch(e){case Boolean:t=r!==null;break;case Number:t=r===null?null:Number(r);break;case Object:case Array:try{t=JSON.parse(r)}catch{t=null}}return t}},es=(r,e)=>!ji(r,e),As={attribute:!0,type:String,converter:qt,reflect:!1,useDefault:!1,hasChanged:es};Symbol.metadata??(Symbol.metadata=Symbol("metadata")),K.litPropertyMetadata??(K.litPropertyMetadata=new WeakMap);let ae=class extends HTMLElement{static addInitializer(e){this._$Ei(),(this.l??(this.l=[])).push(e)}static get observedAttributes(){return this.finalize(),this._$Eh&&[...this._$Eh.keys()]}static createProperty(e,t=As){if(t.state&&(t.attribute=!1),this._$Ei(),this.prototype.hasOwnProperty(e)&&((t=Object.create(t)).wrapped=!0),this.elementProperties.set(e,t),!t.noAccessor){const s=Symbol(),i=this.getPropertyDescriptor(e,s,t);i!==void 0&&Hi(this.prototype,e,i)}}static getPropertyDescriptor(e,t,s){const{get:i,set:o}=qi(this.prototype,e)??{get(){return this[t]},set(n){this[t]=n}};return{get:i,set(n){const l=i?.call(this);o?.call(this,n),this.requestUpdate(e,l,s)},configurable:!0,enumerable:!0}}static getPropertyOptions(e){return this.elementProperties.get(e)??As}static _$Ei(){if(this.hasOwnProperty(Oe("elementProperties")))return;const e=Vi(this);e.finalize(),e.l!==void 0&&(this.l=[...e.l]),this.elementProperties=new Map(e.elementProperties)}static finalize(){if(this.hasOwnProperty(Oe("finalized")))return;if(this.finalized=!0,this._$Ei(),this.hasOwnProperty(Oe("properties"))){const t=this.properties,s=[...zi(t),...Bi(t)];for(const i of s)this.createProperty(i,t[i])}const e=this[Symbol.metadata];if(e!==null){const t=litPropertyMetadata.get(e);if(t!==void 0)for(const[s,i]of t)this.elementProperties.set(s,i)}this._$Eh=new Map;for(const[t,s]of this.elementProperties){const i=this._$Eu(t,s);i!==void 0&&this._$Eh.set(i,t)}this.elementStyles=this.finalizeStyles(this.styles)}static finalizeStyles(e){const t=[];if(Array.isArray(e)){const s=new Set(e.flat(1/0).reverse());for(const i of s)t.unshift(ws(i))}else e!==void 0&&t.push(ws(e));return t}static _$Eu(e,t){const s=t.attribute;return s===!1?void 0:typeof s=="string"?s:typeof e=="string"?e.toLowerCase():void 0}constructor(){super(),this._$Ep=void 0,this.isUpdatePending=!1,this.hasUpdated=!1,this._$Em=null,this._$Ev()}_$Ev(){this._$ES=new Promise(e=>this.enableUpdating=e),this._$AL=new Map,this._$E_(),this.requestUpdate(),this.constructor.l?.forEach(e=>e(this))}addController(e){(this._$EO??(this._$EO=new Set)).add(e),this.renderRoot!==void 0&&this.isConnected&&e.hostConnected?.()}removeController(e){this._$EO?.delete(e)}_$E_(){const e=new Map,t=this.constructor.elementProperties;for(const s of t.keys())this.hasOwnProperty(s)&&(e.set(s,this[s]),delete this[s]);e.size>0&&(this._$Ep=e)}createRenderRoot(){const e=this.shadowRoot??this.attachShadow(this.constructor.shadowRootOptions);return Mi(e,this.constructor.elementStyles),e}connectedCallback(){this.renderRoot??(this.renderRoot=this.createRenderRoot()),this.enableUpdating(!0),this._$EO?.forEach(e=>e.hostConnected?.())}enableUpdating(e){}disconnectedCallback(){this._$EO?.forEach(e=>e.hostDisconnected?.())}attributeChangedCallback(e,t,s){this._$AK(e,s)}_$ET(e,t){const s=this.constructor.elementProperties.get(e),i=this.constructor._$Eu(e,s);if(i!==void 0&&s.reflect===!0){const o=(s.converter?.toAttribute!==void 0?s.converter:qt).toAttribute(t,s.type);this._$Em=e,o==null?this.removeAttribute(i):this.setAttribute(i,o),this._$Em=null}}_$AK(e,t){const s=this.constructor,i=s._$Eh.get(e);if(i!==void 0&&this._$Em!==i){const o=s.getPropertyOptions(i),n=typeof o.converter=="function"?{fromAttribute:o.converter}:o.converter?.fromAttribute!==void 0?o.converter:qt;this._$Em=i;const l=n.fromAttribute(t,o.type);this[i]=l??this._$Ej?.get(i)??l,this._$Em=null}}requestUpdate(e,t,s){if(e!==void 0){const i=this.constructor,o=this[e];if(s??(s=i.getPropertyOptions(e)),!((s.hasChanged??es)(o,t)||s.useDefault&&s.reflect&&o===this._$Ej?.get(e)&&!this.hasAttribute(i._$Eu(e,s))))return;this.C(e,t,s)}this.isUpdatePending===!1&&(this._$ES=this._$EP())}C(e,t,{useDefault:s,reflect:i,wrapped:o},n){s&&!(this._$Ej??(this._$Ej=new Map)).has(e)&&(this._$Ej.set(e,n??t??this[e]),o!==!0||n!==void 0)||(this._$AL.has(e)||(this.hasUpdated||s||(t=void 0),this._$AL.set(e,t)),i===!0&&this._$Em!==e&&(this._$Eq??(this._$Eq=new Set)).add(e))}async _$EP(){this.isUpdatePending=!0;try{await this._$ES}catch(t){Promise.reject(t)}const e=this.scheduleUpdate();return e!=null&&await e,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){if(!this.isUpdatePending)return;if(!this.hasUpdated){if(this.renderRoot??(this.renderRoot=this.createRenderRoot()),this._$Ep){for(const[i,o]of this._$Ep)this[i]=o;this._$Ep=void 0}const s=this.constructor.elementProperties;if(s.size>0)for(const[i,o]of s){const{wrapped:n}=o,l=this[i];n!==!0||this._$AL.has(i)||l===void 0||this.C(i,void 0,o,l)}}let e=!1;const t=this._$AL;try{e=this.shouldUpdate(t),e?(this.willUpdate(t),this._$EO?.forEach(s=>s.hostUpdate?.()),this.update(t)):this._$EM()}catch(s){throw e=!1,this._$EM(),s}e&&this._$AE(t)}willUpdate(e){}_$AE(e){this._$EO?.forEach(t=>t.hostUpdated?.()),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(e)),this.updated(e)}_$EM(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$ES}shouldUpdate(e){return!0}update(e){this._$Eq&&(this._$Eq=this._$Eq.forEach(t=>this._$ET(t,this[t]))),this._$EM()}updated(e){}firstUpdated(e){}};ae.elementStyles=[],ae.shadowRootOptions={mode:"open"},ae[Oe("elementProperties")]=new Map,ae[Oe("finalized")]=new Map,Wi?.({ReactiveElement:ae}),(K.reactiveElementVersions??(K.reactiveElementVersions=[])).push("2.1.1");/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const xe=globalThis,ct=xe.trustedTypes,bs=ct?ct.createPolicy("lit-html",{createHTML:r=>r}):void 0,er="$lit$",J=`lit$${Math.random().toFixed(9).slice(2)}$`,tr="?"+J,Ji=`<${tr}>`,ne=document,Me=()=>ne.createComment(""),je=r=>r===null||typeof r!="object"&&typeof r!="function",ts=Array.isArray,Gi=r=>ts(r)||typeof r?.[Symbol.iterator]=="function",It=`[ 	
\f\r]`,Ue=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,$s=/-->/g,ks=/>/g,Y=RegExp(`>|${It}(?:([^\\s"'>=/]+)(${It}*=${It}*(?:[^ 	
\f\r"'\`<>=]|("|')|))|$)`,"g"),Is=/'/g,Cs=/"/g,sr=/^(?:script|style|textarea|title)$/i,rr=r=>(e,...t)=>({_$litType$:r,strings:e,values:t}),wn=rr(1),Sn=rr(2),Q=Symbol.for("lit-noChange"),U=Symbol.for("lit-nothing"),Us=new WeakMap,ee=ne.createTreeWalker(ne,129);function ir(r,e){if(!ts(r)||!r.hasOwnProperty("raw"))throw Error("invalid template strings array");return bs!==void 0?bs.createHTML(e):e}const Ki=(r,e)=>{const t=r.length-1,s=[];let i,o=e===2?"<svg>":e===3?"<math>":"",n=Ue;for(let l=0;l<t;l++){const a=r[l];let c,u,h=-1,d=0;for(;d<a.length&&(n.lastIndex=d,u=n.exec(a),u!==null);)d=n.lastIndex,n===Ue?u[1]==="!--"?n=$s:u[1]!==void 0?n=ks:u[2]!==void 0?(sr.test(u[2])&&(i=RegExp("</"+u[2],"g")),n=Y):u[3]!==void 0&&(n=Y):n===Y?u[0]===">"?(n=i??Ue,h=-1):u[1]===void 0?h=-2:(h=n.lastIndex-u[2].length,c=u[1],n=u[3]===void 0?Y:u[3]==='"'?Cs:Is):n===Cs||n===Is?n=Y:n===$s||n===ks?n=Ue:(n=Y,i=void 0);const p=n===Y&&r[l+1].startsWith("/>")?" ":"";o+=n===Ue?a+Ji:h>=0?(s.push(c),a.slice(0,h)+er+a.slice(h)+J+p):a+J+(h===-2?l:p)}return[ir(r,o+(r[t]||"<?>")+(e===2?"</svg>":e===3?"</math>":"")),s]};class He{constructor({strings:e,_$litType$:t},s){let i;this.parts=[];let o=0,n=0;const l=e.length-1,a=this.parts,[c,u]=Ki(e,t);if(this.el=He.createElement(c,s),ee.currentNode=this.el.content,t===2||t===3){const h=this.el.content.firstChild;h.replaceWith(...h.childNodes)}for(;(i=ee.nextNode())!==null&&a.length<l;){if(i.nodeType===1){if(i.hasAttributes())for(const h of i.getAttributeNames())if(h.endsWith(er)){const d=u[n++],p=i.getAttribute(h).split(J),v=/([.?@])?(.*)/.exec(d);a.push({type:1,index:o,name:v[2],strings:p,ctor:v[1]==="."?Yi:v[1]==="?"?Xi:v[1]==="@"?Zi:gt}),i.removeAttribute(h)}else h.startsWith(J)&&(a.push({type:6,index:o}),i.removeAttribute(h));if(sr.test(i.tagName)){const h=i.textContent.split(J),d=h.length-1;if(d>0){i.textContent=ct?ct.emptyScript:"";for(let p=0;p<d;p++)i.append(h[p],Me()),ee.nextNode(),a.push({type:2,index:++o});i.append(h[d],Me())}}}else if(i.nodeType===8)if(i.data===tr)a.push({type:2,index:o});else{let h=-1;for(;(h=i.data.indexOf(J,h+1))!==-1;)a.push({type:7,index:o}),h+=J.length-1}o++}}static createElement(e,t){const s=ne.createElement("template");return s.innerHTML=e,s}}function Se(r,e,t=r,s){if(e===Q)return e;let i=s!==void 0?t._$Co?.[s]:t._$Cl;const o=je(e)?void 0:e._$litDirective$;return i?.constructor!==o&&(i?._$AO?.(!1),o===void 0?i=void 0:(i=new o(r),i._$AT(r,t,s)),s!==void 0?(t._$Co??(t._$Co=[]))[s]=i:t._$Cl=i),i!==void 0&&(e=Se(r,i._$AS(r,e.values),i,s)),e}let Qi=class{constructor(e,t){this._$AV=[],this._$AN=void 0,this._$AD=e,this._$AM=t}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(e){const{el:{content:t},parts:s}=this._$AD,i=(e?.creationScope??ne).importNode(t,!0);ee.currentNode=i;let o=ee.nextNode(),n=0,l=0,a=s[0];for(;a!==void 0;){if(n===a.index){let c;a.type===2?c=new ss(o,o.nextSibling,this,e):a.type===1?c=new a.ctor(o,a.name,a.strings,this,e):a.type===6&&(c=new eo(o,this,e)),this._$AV.push(c),a=s[++l]}n!==a?.index&&(o=ee.nextNode(),n++)}return ee.currentNode=ne,i}p(e){let t=0;for(const s of this._$AV)s!==void 0&&(s.strings!==void 0?(s._$AI(e,s,t),t+=s.strings.length-2):s._$AI(e[t])),t++}},ss=class or{get _$AU(){return this._$AM?._$AU??this._$Cv}constructor(e,t,s,i){this.type=2,this._$AH=U,this._$AN=void 0,this._$AA=e,this._$AB=t,this._$AM=s,this.options=i,this._$Cv=i?.isConnected??!0}get parentNode(){let e=this._$AA.parentNode;const t=this._$AM;return t!==void 0&&e?.nodeType===11&&(e=t.parentNode),e}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(e,t=this){e=Se(this,e,t),je(e)?e===U||e==null||e===""?(this._$AH!==U&&this._$AR(),this._$AH=U):e!==this._$AH&&e!==Q&&this._(e):e._$litType$!==void 0?this.$(e):e.nodeType!==void 0?this.T(e):Gi(e)?this.k(e):this._(e)}O(e){return this._$AA.parentNode.insertBefore(e,this._$AB)}T(e){this._$AH!==e&&(this._$AR(),this._$AH=this.O(e))}_(e){this._$AH!==U&&je(this._$AH)?this._$AA.nextSibling.data=e:this.T(ne.createTextNode(e)),this._$AH=e}$(e){const{values:t,_$litType$:s}=e,i=typeof s=="number"?this._$AC(e):(s.el===void 0&&(s.el=He.createElement(ir(s.h,s.h[0]),this.options)),s);if(this._$AH?._$AD===i)this._$AH.p(t);else{const o=new Qi(i,this),n=o.u(this.options);o.p(t),this.T(n),this._$AH=o}}_$AC(e){let t=Us.get(e.strings);return t===void 0&&Us.set(e.strings,t=new He(e)),t}k(e){ts(this._$AH)||(this._$AH=[],this._$AR());const t=this._$AH;let s,i=0;for(const o of e)i===t.length?t.push(s=new or(this.O(Me()),this.O(Me()),this,this.options)):s=t[i],s._$AI(o),i++;i<t.length&&(this._$AR(s&&s._$AB.nextSibling,i),t.length=i)}_$AR(e=this._$AA.nextSibling,t){for(this._$AP?.(!1,!0,t);e!==this._$AB;){const s=e.nextSibling;e.remove(),e=s}}setConnected(e){this._$AM===void 0&&(this._$Cv=e,this._$AP?.(e))}};class gt{get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}constructor(e,t,s,i,o){this.type=1,this._$AH=U,this._$AN=void 0,this.element=e,this.name=t,this._$AM=i,this.options=o,s.length>2||s[0]!==""||s[1]!==""?(this._$AH=Array(s.length-1).fill(new String),this.strings=s):this._$AH=U}_$AI(e,t=this,s,i){const o=this.strings;let n=!1;if(o===void 0)e=Se(this,e,t,0),n=!je(e)||e!==this._$AH&&e!==Q,n&&(this._$AH=e);else{const l=e;let a,c;for(e=o[0],a=0;a<o.length-1;a++)c=Se(this,l[s+a],t,a),c===Q&&(c=this._$AH[a]),n||(n=!je(c)||c!==this._$AH[a]),c===U?e=U:e!==U&&(e+=(c??"")+o[a+1]),this._$AH[a]=c}n&&!i&&this.j(e)}j(e){e===U?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,e??"")}}class Yi extends gt{constructor(){super(...arguments),this.type=3}j(e){this.element[this.name]=e===U?void 0:e}}class Xi extends gt{constructor(){super(...arguments),this.type=4}j(e){this.element.toggleAttribute(this.name,!!e&&e!==U)}}class Zi extends gt{constructor(e,t,s,i,o){super(e,t,s,i,o),this.type=5}_$AI(e,t=this){if((e=Se(this,e,t,0)??U)===Q)return;const s=this._$AH,i=e===U&&s!==U||e.capture!==s.capture||e.once!==s.once||e.passive!==s.passive,o=e!==U&&(s===U||i);i&&this.element.removeEventListener(this.name,this,s),o&&this.element.addEventListener(this.name,this,e),this._$AH=e}handleEvent(e){typeof this._$AH=="function"?this._$AH.call(this.options?.host??this.element,e):this._$AH.handleEvent(e)}}let eo=class{constructor(e,t,s){this.element=e,this.type=6,this._$AN=void 0,this._$AM=t,this.options=s}get _$AU(){return this._$AM._$AU}_$AI(e){Se(this,e)}};const to=xe.litHtmlPolyfillSupport;to?.(He,ss),(xe.litHtmlVersions??(xe.litHtmlVersions=[])).push("3.3.1");const so=(r,e,t)=>{const s=t?.renderBefore??e;let i=s._$litPart$;if(i===void 0){const o=t?.renderBefore??null;s._$litPart$=i=new ss(e.insertBefore(Me(),o),o,void 0,t??{})}return i._$AI(r),i};/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const Re=globalThis;let oe=class extends ae{constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){var t;const e=super.createRenderRoot();return(t=this.renderOptions).renderBefore??(t.renderBefore=e.firstChild),e}update(e){const t=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(e),this._$Do=so(t,this.renderRoot,this.renderOptions)}connectedCallback(){super.connectedCallback(),this._$Do?.setConnected(!0)}disconnectedCallback(){super.disconnectedCallback(),this._$Do?.setConnected(!1)}render(){return Q}};oe._$litElement$=!0,oe.finalized=!0,Re.litElementHydrateSupport?.({LitElement:oe});const ro=Re.litElementPolyfillSupport;ro?.({LitElement:oe});(Re.litElementVersions??(Re.litElementVersions=[])).push("4.2.1");const rs=Symbol.for("controller"),io=r=>typeof r=="object"&&r!==null&&(rs in r||"hostConnected"in r||"hostDisconnected"in r||"hostUpdate"in r||"hostUpdated"in r),kn=r=>typeof r?.then=="function";let Pe;const Ee=r=>{Pe!==r&&(Pe=r,queueMicrotask(()=>Pe===r?Pe=void 0:0))},mt=r=>Pe;let X=[];const oo=r=>{if(r===void 0){X=[];return}const e=X.indexOf(r);X=e===-1?[...X,r]:X.slice(0,e+1),queueMicrotask(()=>X=[])},no=()=>X;let ce;const In=r=>{ce!==r&&(ce=r,queueMicrotask(()=>ce===r?ce=void 0:0))},ao=()=>{const r=ce;return ce=void 0,r},lo=async(r,e)=>{const t=is(r);if(t===void 0)return r;if(await t.ready,typeof e=="function"){const s=t.watchExports(i=>e(i,s))}return t.exports},co=async r=>{const e=is(r);return await e.ready,e},is=r=>{const t=mt().manager.X(r);if(t!==void 0)return t;if(io(r))return r;const s=ao();if(s!==void 0)return s};let zt=!1;const Cn=r=>{zt=!0;try{return r()}finally{zt=!1}},ho=(r,e,t)=>{const s=Object.keys(r),i=s.length;he===void 0&&queueMicrotask(os),he??(he=new Map);let o=he.get(r);return o===void 0&&(o={callbacks:[],keyCount:i},he.set(r,o)),o.keyCount!==i&&(o.callbacks.forEach(n=>n(s)),o.callbacks=[],o.keyCount=i),o.callbacks.push(n=>{const l=c=>C(e,null,c),a=n[i];a===void 0?l(void 0):r[a]===t?l(a):l(void 0)}),t};let he;const os=()=>{he?.forEach(({callbacks:r},e)=>{const t=Object.keys(e);r.forEach(s=>s(t))}),he=void 0},uo=(r,e,t)=>{const s=r.manager;return s.V!==U&&s.V!==t&&s.S(void 0,void 0),s.T.length===0&&queueMicrotask(()=>s.S(void 0,void 0)),s.V=t,s.T.push((i,o)=>C(e,void 0,t===o?i:void 0)),t},po=(r=[mt(),...no()],e,t)=>{const s=Array.isArray(r)?r:[r];let i=s.length+1;const o=n=>{i-=1,n!==void 0&&(i=Math.min(i,0)),i===0&&e(n)};s.forEach(n=>ho(n,l=>o(l===void 0?void 0:{key:l,host:n,isReactive:!1}),t));for(const n of s)if("manager"in n&&n.manager.component===n){uo(n,l=>o(l===void 0?void 0:{key:l,host:n,isReactive:!0}),t);break}return t},fo=(r="",e={},t=mt())=>{const s={emit:i=>{r===""&&os();const o=new CustomEvent(r,{detail:i,cancelable:!0,bubbles:!0,composed:!0,...e});return t.el.dispatchEvent(o),o}};return r===""&&po(void 0,i=>r=i.key,s),s},Un=fo.bind(null,"");var nr;nr=rs;var de,ue,te,pe,fe,ge,me,ve,G,se,O,j,z,_e,Ze;class go{constructor(e){A(this,_e);A(this,de,void 0);A(this,ue,void 0);A(this,te,void 0);A(this,pe,void 0);A(this,fe,void 0);A(this,ge,void 0);A(this,me,void 0);A(this,ve,void 0);A(this,G,void 0);A(this,se,void 0);A(this,O,void 0);A(this,j,void 0);A(this,z,void 0);S(this,de,[]),S(this,ue,[]),S(this,te,[]),S(this,pe,[]),S(this,fe,[]),S(this,ge,[]),S(this,me,[]),S(this,ve,[]),S(this,G,[]),S(this,se,!1),this.P=new Ne,this.connectedCalled=!1,this.loadedCalled=!1,this[nr]=!0,S(this,z,[]);const t=this,s=e??mt();S(t,O,s),t.ready=t.P.promise,S(t,j,Ps(t)),t.component=s,f(t,O).addController(t),f(t,O).manager===void 0||(oo(t),queueMicrotask(()=>t.catchUpLifecycle()))}catchUpLifecycle(){const{manager:e}=f(this,O);e.connectedCalled&&!this.connectedCalled&&this.triggerConnected(),f(e,se)&&this.triggerLoad().then(()=>e.loadedCalled&&this.triggerLoaded()).catch(console.error)}get exports(){return f(this,j)}set exports(e){const t=f(this,j);t!==e&&(S(this,j,e),f(this,z).forEach(C),this.connectedCalled&&this.O!==!1&&f(this,O).requestUpdate(this.O,t)),this.P.resolve(e)}setProvisionalExports(e,t=!0){S(this,j,t?Ps(e):e),f(this,z).forEach(C)}watchExports(e){const t=()=>e(f(this,j));return f(this,z).push(t),()=>void f(this,z).splice(f(this,z).indexOf(t),1)}get use(){return Ee(f(this,O)),lo}get useRef(){return Ee(f(this,O)),co}get useRefSync(){return Ee(f(this,O)),is}controllerRemoved(){f(this,O).el.isConnected&&this.triggerDisconnected(),this.triggerDestroy()}onConnected(e){f(this,de).push(e)}onDisconnected(e){f(this,ue).push(e)}onLoad(e){f(this,te).push(e)}onLoaded(e){f(this,pe).push(e)}onUpdate(e){f(this,fe).push(e)}onUpdated(e){f(this,ge).push(e)}onDestroy(e){f(this,me).push(e)}onLifecycle(e){f(this,ve).push(e),this.connectedCalled&&f(this,O).el.isConnected&&F(this,_e,Ze).call(this,e)}triggerConnected(){const e=this;e.hostConnected&&C(e.hostConnected,e),f(e,de).forEach(C),e.triggerLifecycle(),e.connectedCalled=!0}triggerDisconnected(){const e=this;e.hostDisconnected&&C(e.hostDisconnected,e),f(e,ue).forEach(C),f(e,G).forEach(C),S(e,G,[])}async triggerLoad(){if(f(this,se))return;S(this,se,!0);const e=this;e.hostLoad&&await Ht(e.hostLoad,e),f(this,te).length>0&&await Promise.allSettled(f(this,te).map(Ht)),this.P.resolve(f(this,j))}triggerLoaded(){this.loadedCalled||(this.hostLoaded&&C(this.hostLoaded,this),f(this,pe).forEach(C),this.loadedCalled=!0)}triggerUpdate(e){this.hostUpdate&&C(this.hostUpdate,this,e),f(this,fe).forEach(Ts,e)}triggerUpdated(e){this.hostUpdated&&C(this.hostUpdated,this,e),f(this,ge).forEach(Ts,e)}triggerDestroy(){this.hostDestroy&&C(this.hostDestroy,this),f(this,me).forEach(C)}triggerLifecycle(){this.hostLifecycle&&F(this,_e,Ze).call(this,()=>this.hostLifecycle()),f(this,ve).forEach(F(this,_e,Ze),this)}}de=new WeakMap,ue=new WeakMap,te=new WeakMap,pe=new WeakMap,fe=new WeakMap,ge=new WeakMap,me=new WeakMap,ve=new WeakMap,G=new WeakMap,se=new WeakMap,O=new WeakMap,j=new WeakMap,z=new WeakMap,_e=new WeakSet,Ze=function(e){Ee(f(this,O));const t=C(e);(Array.isArray(t)?t:[t]).forEach(i=>{typeof i=="function"?f(this,G).push(i):typeof i=="object"&&typeof i.remove=="function"&&f(this,G).push(i.remove)})};function Ts(r){C(r,void 0,this)}const mo=go,Ps=r=>{if(typeof r!="object"&&typeof r!="function"||r===null)return r;const e={get(s,i,o){if(!((i==="exports"||i==="_exports")&&i in s&&s[i]===t)&&(i in s||i in Promise.prototype||typeof i=="symbol"))return typeof s=="function"?s[i]:Reflect.get(s,i,o)}},t=new Proxy(r,e);return t},vo=1,_o=2,yo=4,wo=8,So=16,Ao=32,bo=64,ar=r=>{let e=r;for(;e=e.parentNode??e.host;)if(e?.constructor?.lumina){const t=e;return t.manager?.loadedCalled||(t.J??t._offspring).push(r),(t.I??t._postLoad).promise}return!1},Es={};function lr(){}const et=Object.defineProperty,$o=globalThis.HTMLElement??lr;var x,B,ye,qe,Bt;const ns=class ns extends $o{constructor(){var i;super();A(this,qe);A(this,x,void 0);A(this,B,void 0);A(this,ye,void 0);S(this,B,{}),S(this,ye,[]),this.I=new Ne,this.H=new Ne,this.J=[];const t=this,s=t.constructor;t._offspring=t.J,t._postLoad=t.I,s.C?.forEach(o=>{Object.hasOwn(t,o)&&(f(t,B)[o]=t[o],delete t[o])}),s.A?F(i=t,qe,Bt).call(i,{a:s.A}):s.B.then(async o=>{var n;await s.K.p,F(n=t,qe,Bt).call(n,await(o.default?.then(l=>typeof l=="function"?{a:l}:l)??o))}).catch(o=>{t.H.reject(o),setTimeout(()=>{throw o})})}static F(){for(const t of this.C??[])et(this.prototype,t,{configurable:!0,enumerable:!0,get(){return f(this,B)[t]},set(s){f(this,B)[t]=s}});for(const t of this.E??[])et(this.prototype,t,{async value(...s){return f(this,x)||await this.H.promise,await f(this,x)[t](...s)},configurable:!0});for(const t of this.D??[])et(this.prototype,t,{value(...s){return f(this,x)[t](...s)},configurable:!0})}get manager(){return f(this,x)?.manager}attributeChangedCallback(t,s,i){f(this,x)?.attributeChangedCallback(t,s,i),f(this,x)||f(this,ye).push(t)}connectedCallback(){f(this,x)?f(this,x).connectedCallback?.():queueMicrotask(()=>this.G=ar(this))}disconnectedCallback(){f(this,x)?.disconnectedCallback?.()}async componentOnReady(){return await this.H.promise,this}addController(){}requestUpdate(){f(this,x)?.requestUpdate()}};x=new WeakMap,B=new WeakMap,ye=new WeakMap,qe=new WeakSet,Bt=function(t){const s=this.constructor,i=s.L,o=f(this,B),n=Object.values(t).find(d=>d.L===i),l=`${i}--lazy`;let a=n;for(;a&&!Object.hasOwn(a,"lumina");)a=Object.getPrototypeOf(a);Io(a),!s.A&&(s.A=n,customElements.define(l,n)),n.N=this;const u=document.createElement(l);n.N=void 0,S(this,x,u),S(this,B,u),f(this,ye).forEach(d=>u.attributeChangedCallback(d,null,this.getAttribute(d))),Object.entries(o).forEach(ko,u);const h=this.isConnected;(h||this.G)&&(u.connectedCallback?.(),h||u.disconnectedCallback())},ns.lumina=!0;let Os=ns;function ko([r,e]){this[r]=e}const Io=r=>{const e=r.prototype,t=Element.prototype;Object.hasOwn(e,"isConnected")||(e.setAttribute=function(i,o){t.setAttribute.call(this.el,i,o)},e.removeAttribute=function(i){t.removeAttribute.call(this.el,i)},et(e,"isConnected",{get(){return Reflect.get(t,"isConnected",this.el)}}))};/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const cr={ATTRIBUTE:1,CHILD:2,PROPERTY:3,BOOLEAN_ATTRIBUTE:4,EVENT:5,ELEMENT:6},hr=r=>(...e)=>({_$litDirective$:r,values:e});let dr=class{constructor(e){}get _$AU(){return this._$AM._$AU}_$AT(e,t,s){this._$Ct=e,this._$AM=t,this._$Ci=s}_$AS(e,t){return this.update(e,t)}update(e,t){return this.render(...t)}};/**
 * @license
 * Copyright 2018 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const Co=hr(class extends dr{constructor(r){if(super(r),r.type!==cr.ATTRIBUTE||r.name!=="class"||r.strings?.length>2)throw Error("`classMap()` can only be used in the `class` attribute and must be the only part in the attribute.")}render(r){return" "+Object.keys(r).filter(e=>r[e]).join(" ")+" "}update(r,[e]){if(this.st===void 0){this.st=new Set,r.strings!==void 0&&(this.nt=new Set(r.strings.join(" ").split(/\s/).filter(s=>s!=="")));for(const s in e)e[s]&&!this.nt?.has(s)&&this.st.add(s);return this.render(e)}const t=r.element.classList;for(const s of this.st)s in e||(t.remove(s),this.st.delete(s));for(const s in e){const i=!!e[s];i===this.st.has(s)||this.nt?.has(s)||(i?(t.add(s),this.st.add(s)):(t.remove(s),this.st.delete(s)))}return Q}});/**
 * @license
 * Copyright 2018 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const ur="important",Uo=" !"+ur,To=hr(class extends dr{constructor(r){if(super(r),r.type!==cr.ATTRIBUTE||r.name!=="style"||r.strings?.length>2)throw Error("The `styleMap` directive must be used in the `style` attribute and must be the only part in the attribute.")}render(r){return Object.keys(r).reduce((e,t)=>{const s=r[t];return s==null?e:e+`${t=t.includes("-")?t:t.replace(/(?:^(webkit|moz|ms|o)|)(?=[A-Z])/g,"-$&").toLowerCase()}:${s};`},"")}update(r,[e]){const{style:t}=r.element;if(this.ft===void 0)return this.ft=new Set(Object.keys(e)),this.render(e);for(const s of this.ft)e[s]==null&&(this.ft.delete(s),s.includes("-")?t.removeProperty(s):t[s]=null);for(const s in e){const i=e[s];if(i!=null){this.ft.add(s);const o=typeof i=="string"&&i.endsWith(Uo);s.includes("-")||o?t.setProperty(s,o?i.slice(0,-11):i,o?ur:""):t[s]=i}}return Q}});var V,M,we;class Po extends mo{constructor(t){super(t);A(this,V,void 0);A(this,M,void 0);A(this,we,void 0);this.destroyed=!1,this.R=!1,this.V=U,this.T=[],S(this,we,new WeakMap),S(this,M,t),this.exports=void 0,this.hasDestroy=Vt in t&&typeof t.destroy=="function",oe.prototype.addController.call(t,{hostConnected:()=>{if(this.destroyed){const s=t.el.localName;throw t.el.remove(),new Error(`The ${s} component has already been destroyed. It cannot be used again. If you meant to disconnect and reconnect a component without automatic destroy, set the ${Vt} prop.`)}f(this,V)!==void 0&&clearTimeout(f(this,V)),os();for(const s of t.M)"triggerConnected"in s?s.triggerConnected():C(s.hostConnected,s)},hostDisconnected:()=>{for(const s of t.M)"triggerDisconnected"in s?s.triggerDisconnected():C(s.hostDisconnected,s);this.hasDestroy&&!this.destroyed&&this.U()},hostUpdate:()=>{for(const s of t.M)"triggerUpdate"in s?s.triggerUpdate(this.Q):C(s.hostUpdate,s,this.Q)},hostUpdated:()=>{for(const s of t.M)"triggerUpdated"in s?s.triggerUpdated(this.Q):C(s.hostUpdated,s,this.Q);this.Q=void 0}}),queueMicrotask(()=>this.R=!0),Ee(t)}async destroy(){if(!this.destroyed){f(this,M).el.isConnected&&(this.hasDestroy=!1,f(this,M).el.remove()),S(this,V,void 0),this.destroyed=!0;for(const t of f(this,M).M)"triggerDestroy"in t?t.triggerDestroy():C(t.hostDestroy,t);f(this,M).M.splice(0)}}U(){f(this,V)!==void 0&&clearTimeout(f(this,V)),!f(this,M).el.isConnected&&!f(this,M).autoDestroyDisabled&&S(this,V,xi(()=>void f(this,M).destroy(),Eo))}S(t,s){const i=this.T;this.V=U,this.T=[],i.forEach(o=>o(t,s))}W(t,s){(typeof s=="object"&&s!==null||typeof s=="function")&&f(this,we).set(s,t)}X(t){if(typeof t=="object"&&t!==null||typeof t=="function")return f(this,we).get(t)}}V=new WeakMap,M=new WeakMap,we=new WeakMap;let Eo=1e3;const Vt="autoDestroyDisabled";var re,ze,Be,ie,H,ut,pr,pt,fr;const De=class De extends oe{constructor(){super();A(this,ut);A(this,pt);A(this,re,void 0);A(this,ze,void 0);A(this,Be,void 0);A(this,ie,void 0);A(this,H,void 0);this.M=[],this.manager=new Po(this);const t=this,s=t.constructor,i=s.N,o=s.K.o,n=De.prototype.shouldUpdate;S(t,ie,i?.H??new Ne),t.I=i?.I??new Ne,t.J=i?.J??[],t._offspring=t.J,t._postLoad=t.I,t.el=i??t,S(t,Be,t.enableUpdating),t.enableUpdating=lr,t.shouldUpdate!==n&&(S(t,ze,t.shouldUpdate),t.shouldUpdate=n),o&&(S(t,re,new Map),s.elementProperties.forEach((l,a)=>f(t,re).set(a,o())))}static finalizeStyles(t){const s=super.finalizeStyles(t),i=this.shadowRootOptions===Es;return this.K?.commonStyles===void 0||i?s:[this.K.commonStyles,...s]}static createProperty(t,s){const i=typeof s=="number"?s:Array.isArray(s)?s[0]:0,o=Array.isArray(s)?s[1]:void 0,n=o?.hasChanged??es,l={attribute:i&vo&&typeof t=="string"?Ei(t):!1,reflect:!!(i&_o),type:i&yo?Boolean:i&wo?Number:void 0,state:!!(i&So),readOnly:!!(i&Ao),noAccessor:!!(i&bo),c:!1,...o,hasChanged(a,c){const u=n(a,c);return l.c=u,u}};super.createProperty(t,l)}static getPropertyDescriptor(t,s,i){const o=this.K,n=super.getPropertyDescriptor(t,s,i);return i.d=n,{...n,get(){return o.t?.(f(this,re).get(t)),n.get?.call(this)},set(l){const a=this.manager;if(i.readOnly&&!zt&&(a.R||a.connectedCalled))throw Error(`Cannot assign to read-only property "${t}" of ${this.el.localName}. Trying to assign "${l}"`);n.set.call(this,l??void 0),i.c&&f(this,re)?.get(t)?.notify(),a.T.length>0&&a?.S(t,l)}}}connectedCallback(){if(this.el.hasAttribute("defer-hydration"))return;const t=this.constructor.K.c?.(()=>this.requestUpdate());S(this,H,t);const s=!this.manager.connectedCalled;super.connectedCallback(),s?queueMicrotask(()=>F(this,pt,fr).call(this).catch(i=>{f(this,ie).reject(i),setTimeout(()=>{throw i})})):t&&this.requestUpdate()}disconnectedCallback(){super.disconnectedCallback(),f(this,H)?.destroy(),S(this,H,void 0)}createRenderRoot(){const t=this.el.shadowRoot,s=this.constructor,i=s.shadowRootOptions,n=t??(i===Es?this.el:this.el.attachShadow(i));if(t)return oe.prototype.createRenderRoot.call(this),t;if(this.isConnected){const l=n.getRootNode();l.adoptedStyleSheets=[...l.adoptedStyleSheets,...s.elementStyles.map(a=>"styleSheet"in a?a.styleSheet:a)]}return n}shouldUpdate(t){var s;return this.manager.Q=t,((s=f(this,ze))==null?void 0:s.call(this,t))??!0}update(t){f(this,H)?F(this,ut,pr).call(this,t):super.update(t)}listen(t,s,i){const o=s?.bind(this)??s;this.manager.onLifecycle(()=>(this.el.addEventListener(t,o,i),()=>this.el.removeEventListener(t,o,i)))}listenOn(t,s,i,o){const n=i?.bind(this)??i;this.manager.onLifecycle(()=>(t.addEventListener(s,n,o),()=>t.removeEventListener(s,n,o)))}async componentOnReady(){return await f(this,ie).promise,this}addController(t){this.M.push(t),!(rs in t)&&this.renderRoot&&this.el.isConnected&&t.hostConnected?.()}removeController(t){this.M.splice(this.M.indexOf(t),1),t.controllerRemoved?.()}};re=new WeakMap,ze=new WeakMap,Be=new WeakMap,ie=new WeakMap,H=new WeakMap,ut=new WeakSet,pr=function(t){try{f(this,H).clear(),this.constructor.K.r(f(this,H),()=>ls(De.prototype,this,"update").call(this,t))}catch(s){throw f(this,H).clear(),s}},pt=new WeakSet,fr=async function(){const t=this.el.G??ar(this.el);t&&await t;const s=[];for(const o of this.M)"triggerLoad"in o?s.push(o.triggerLoad()):s.push(Ht(o.hostLoad,o));await Promise.all(s),await this.load?.(),this.manager.hasDestroy&&this.manager.onUpdate(o=>o.has(Vt)&&this.manager.U()),f(this,Be).call(this,!0),this.performUpdate(),this.I.resolve(),await Promise.resolve();const i=this.J.filter(o=>!o.manager?.loadedCalled);i.length&&await Promise.allSettled(i.map(async o=>await o.componentOnReady())),this.J.length=0,this.el.setAttribute(this.constructor.K.hydratedAttribute,"");for(const o of this.M)"triggerLoaded"in o?o.triggerLoaded():C(o.hostLoaded,o);this.loaded?.(),f(this,ie).resolve()},De.lumina=!0;let xs=De;const Oo=r=>{let e;const t=i=>{e=new URL(i,globalThis.location?.href||void 0).href},s={...r,getAssetPath(i){const o=new URL(i,e);return o.origin!==globalThis.location?.origin?o.href:o.pathname},setAssetPath:t,customElement(i,o){o.K=s,o.L=i,customElements.get(i)||customElements.define(i,o)}};return t(r.defaultAssetPath),s},Pn=r=>typeof r=="object"&&r!=null?Co(r):r,En=r=>typeof r=="object"&&r!=null?To(r):r,On=U;function xn(r,e,t){t==null?r.removeAttribute(e):r.setAttribute(e,t)}const Rn={toAttribute:r=>r===!0?"":r===!1?null:r};/*! All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
v3.2.1 */const gr="calcite-mode-auto",mr="calcite-mode-dark",xo="calcite-mode-light",Ln={autoMode:gr,darkMode:mr,lightMode:xo,rtl:"calcite--rtl",calciteAnimate:"calcite-animate",calciteAnimateInUp:"calcite-animate__in-up",calciteAnimateInDown:"calcite-animate__in-down",calciteAnimateInRight:"calcite-animate__in-right",calciteAnimateInLeft:"calcite-animate__in-left"},Dn={filter:250,nextTick:0,resize:150,reposition:100},Nn=25;function Rs(){const{classList:r}=document.body,e=window.matchMedia("(prefers-color-scheme: dark)").matches,t=()=>r.contains(mr)||r.contains(gr)&&e?"dark":"light",s=n=>document.body.dispatchEvent(new CustomEvent("calciteModeChange",{bubbles:!0,detail:{mode:n}})),i=n=>{o!==n&&s(n),o=n};let o=t();s(o),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",n=>i(n.matches?"dark":"light")),new MutationObserver(()=>i(t())).observe(document.body,{attributes:!0,attributeFilter:["class"]})}const Le=globalThis.calciteConfig,Mn=Le?.focusTrapStack||[],jn=Le?.logLevel||"info",Ls="3.2.1",Ro="2025-05-29",Lo="618973fec";function Do(){if(Le&&Le.version)return;console.info(`Using Calcite Components ${Ls} [Date: ${Ro}, Revision: ${Lo}]`);const r=Le||globalThis.calciteConfig||{};Object.defineProperty(r,"version",{value:Ls,writable:!1}),globalThis.calciteConfig=r}function No(){document.readyState==="interactive"?Rs():document.addEventListener("DOMContentLoaded",()=>Rs(),{once:!0}),Do()}No();const Mo=Oo({defaultAssetPath:"https://js.arcgis.com/calcite-components/3.2.1/",hydratedAttribute:"calcite-hydrated"}),{customElement:Hn,getAssetPath:qn,setAssetPath:jo}=Mo;/*! All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
v3.2.1 */let vr=!1;const Ho=r=>{vr=!0,jo(r)};let _r;function qo(){vr||Ho(Rt(Lr(_r)))}function zo(r){const e=[];for(const t of Object.keys(r))customElements.get(`calcite-${t}`)||e.push(r[t]?.());return e.length>0?Promise.all(e):null}_r="components/assets";const yr=Symbol("widget"),wr=Symbol("widget-test-data"),Bo=[],Vo={},ht=new WeakMap;function Sr(r,e){let t=e.children;if(t?.length)for(let i=0;i<t.length;++i)t[i]=Sr(r,t[i]);else t=Bo;const s=e.vnodeSelector;if(dt(s)){const i=e.properties||Vo,o=i.key||s,n={key:o,afterCreate:Fo,afterUpdate:Wo,afterRemoved:Ar,parentWidget:r,widgetConstructor:s,widgetProperties:{...i,key:o,children:t}};return{vnodeSelector:s.vnodeSelector,properties:n,children:void 0,text:void 0,domNode:null}}return e}function Fo(r,e,t,{parentWidget:s,widgetConstructor:i,widgetProperties:o}){const n=new i(o);n.container=r,ht.set(r,n),n.afterCreate?.(n,r),s.addHandles(nt(()=>Ar(r))),queueMicrotask(()=>{n[wr].projector.renderNow()})}function Wo(r,e,t,{widgetProperties:s}){const i=ht.get(r);i&&(i.set(s),i.afterUpdate?.(i,r))}function Ar(r){const e=ht.get(r);e&&(e.afterRemoved?.(e,r),e.destroy(),ht.delete(r))}function dt(r){return typeof r=="function"&&r[yr]}const Ds=new Set;function Jo(r){Ds.add(r),r.finally(()=>Ds.delete(r))}function Go(r){return nt()}const vt=new Map;function br(){vt.clear()}function Ko(r){return vt.get(r)}function Qo(r,e){vt.set(r,e)}function Ct(r){vt.delete(r)}function Yo(...r){const e=cs.acquire();for(let s=0;s<r.length;s++){const i=r[s],o=typeof i;if(o==="string")e.push(i);else if(Array.isArray(i))e.push.apply(e,i);else if(o==="object")for(const n in i)i[n]&&e.push(n)}const t=e.join(" ");return cs.release(e),t}(()=>{const r=new Map,e=new ResizeObserver(s=>{br();for(const i of s)r.get(i.target)?.(i)}),t=(s,i,o)=>(r.set(s,i),e.observe(s,o),nt(()=>{e.unobserve(s),r.delete(s)}));return(s,i,o)=>{let n=null;return Dr([Lt(()=>typeof s=="function"?s():s,l=>{n?.remove(),l&&(n=t(l,i,o))},qs),nt(()=>n?.remove())])}})();async function Xo(r,e){await Nr(Mr(e));const t=typeof r=="function"?r():r;t&&("setFocus"in t&&typeof t.setFocus=="function"?await t.setFocus():t instanceof HTMLElement&&t.focus())}var Ns;let Zo=0;function $r(r,e){const t=Object.prototype.hasOwnProperty;for(const s in e)t.call(e,s)&&t.call(r,s)&&(r[s]!=null&&e[s]!=null&&typeof r[s]=="object"&&typeof e[s]=="object"?$r(r[s],e[s]):r[s]=e[s]);return r}const en=yi({postProcessProjectionOptions(r){const e=r.eventHandlerInterceptor,t=/capture$/i;r.eventHandlerInterceptor=(s,i,o,n)=>{const l=e?.(s,i,o,n),a=t.test(s);if(!((s=s.replace(t,"")).toLowerCase()in o)||a){const c=s[2].toLowerCase()+s.slice(3),u=p=>l?.call(o,p);o.addEventListener(c,u,a);const h=()=>o.removeEventListener(c,u,a),d=n.afterRemoved;n.afterRemoved=p=>{d?.(p),h()}}return l}},handleInterceptedEvent(r,e,t,s){const{eventPhase:i,type:o}=s,n=i===Event.CAPTURING_PHASE;let l=`on${o}${n?"capture":""}`;const a=e.properties;(a&&l in a||(l=`on${o[0].toUpperCase()}${o.slice(1)}${n?"Capture":""}`,a&&l in a))&&(br(),r.scheduleRender(),a[l].call(a.bind||t,s))}});let Ut=!1;var Ae;let P=(Ae=class extends jr.EsriPromiseMixin(Gt.EventedAccessor){constructor(e,t){super(e,t),this._attached=!1,this._projector=en,this._readyForTrueRender=!1,this.key=this,this.autoRenderingEnabled=!0,this._loadLocale=Hr(async()=>{if(this._messageBundleProps?.length){const a=await Promise.allSettled(this._messageBundleProps.map(async({bundlePath:c,propertyName:u})=>{if(this.destroyed)return;let h=await qr(c);this.uiStrings&&Object.keys(this.uiStrings)&&(h=$r(zr(h),this.uiStrings)),this[u]=h}));if(this.destroyed)return;for(const c of a)c.status==="rejected"&&xt.getLogger(this).error("widget-intl:locale-error",this.declaredClass,c.reason)}await this.loadLocale()}),this.addHandles(Go()),qo();const s="esri-widget-uid-"+Br(),i=this.render.bind(this);this._trackingTarget=new Vr(()=>{this.autoRenderingEnabled&&this.scheduleRender()});const o=()=>({vnodeSelector:"div",properties:{key:`${s}-hidden`,class:"",styles:{display:"none"}},domNode:null,children:void 0,text:void 0}),n=()=>{var h;if(!this._readyForTrueRender||this.destroyed)return null;const a=i()??o(),c=a.properties??(a.properties={});if(c.key??(c.key=s),dt(a.vnodeSelector)){if(!this.visible)return o()}else this.visible?c.styles||(c.styles={}):(c.class="",c.styles={display:"none"}),(h=c.styles).display??(h.display="");let u=0;return a.children?.forEach(d=>{var p;dt(d.vnodeSelector)||(d.properties??(d.properties={}),(p=d.properties).key??(p.key=`${this.id}--${u++}`))}),Sr(this,a)};this.render=()=>{if(Ut)return n();let a=Ko(this)??null;if(a)return a;this._trackingTarget.clear(),Ut=!0;try{a=Fr(this._trackingTarget,n)}catch(c){throw xt.getLogger(this).error(c),c}finally{Ut=!1}return a&&Qo(this,a),a};const l=this.beforeFirstRender();l?this._resourcesFetch=l.then(()=>{this._readyForTrueRender=!0,this._postInitialize()}):(this._resourcesFetch=Promise.resolve().then(()=>{this._postInitialize()}),this._readyForTrueRender=!0),this.addResolvingPromise(this._resourcesFetch),Jo(this._resourcesFetch)}normalizeCtorArgs(e,t){const s={...e};return t&&(s.container=t),s}postInitialize(){}beforeFirstRender(){const e=this.loadDependencies();return this._messageBundleProps?.length||e?Promise.all([e,this._loadLocale()]).then(()=>{}).catch(hs):null}loadDependencies(){return null}loadLocale(){return null}destroy(){this.destroyed||(ds(this._trackingTarget),ds(this.viewModel),this._detach(this.container),this._set("container",null),this._emitter.clear(),this.render=()=>null,this._projector=null,Ct(this))}set container(e){this._get("container")||this._set("container",e)}castContainer(e){return ni(e)}get domNode(){return this.container}set domNode(e){this.container=e}get icon(){return null}set icon(e){this._overrideIfSome("icon",e)}get id(){return this._get("id")||this.container?.id||Date.now().toString(16)+"-widget-"+Zo++}set id(e){e&&this._set("id",e)}get label(){return this.declaredClass.split(".").pop()}set label(e){this._overrideIfSome("label",e)}get renderable(){return this._resourcesFetch}get visible(){return this._get("visible")}set visible(e){this._set("visible",e)}get[(Ns=yr,wr)](){return{projector:this._projector}}render(){throw new Error("not implemented")}scheduleRender(){this.destroyed||(Ct(this),this._projector.scheduleRender())}classes(...e){return Yo.apply(this,e)}renderNow(){Ct(this),this._projector.renderNow()}_postInitialize(){if(this.destroyed)return;this.scheduleRender(),this._delegatedEventNames?.length&&this.addHandles(Lt(()=>this.viewModel,(t,s)=>{s&&this.removeHandles("delegated-events"),t&&Wr(t)&&this.addHandles(this._delegatedEventNames.map(i=>Ye(t,i,o=>{this.emit(i,o)})),"delegated-events")},qs)),this.postInitialize();const e=async()=>{await this._loadLocale().catch(hs),this.scheduleRender()};this.addHandles([Jr(e),Lt(()=>this.uiStrings,e)]),this.addHandles(Gr(()=>this.container,t=>{this.destroyed||this._attach(t)},{initial:!0,once:!0}))}_attach(e){e&&(this._projector.merge(e,this.render),this._attached=!0)}_detach(e){this._attached&&(this._projector.detach(this.render),this._attached=!1),e?.parentNode?.removeChild(e)}},Ae[Ns]=!0,Ae.vnodeSelector="div",Ae);g([m()],P.prototype,"_readyForTrueRender",void 0),g([m({value:null})],P.prototype,"container",null),g([Kr("container")],P.prototype,"castContainer",null),g([m()],P.prototype,"icon",null),g([m()],P.prototype,"id",null),g([m()],P.prototype,"label",null),g([m()],P.prototype,"renderable",null),g([m()],P.prototype,"uiStrings",void 0),g([m()],P.prototype,"viewModel",void 0),g([m({value:!0})],P.prototype,"visible",null),g([m()],P.prototype,"key",void 0),g([m()],P.prototype,"children",void 0),g([m()],P.prototype,"afterCreate",void 0),g([m()],P.prototype,"afterUpdate",void 0),g([m()],P.prototype,"afterRemoved",void 0),P=g([Fe("esri.widgets.Widget")],P);const tn=P;function Ms(r){return(e,t)=>{e.hasOwnProperty("_messageBundleProps")||(e._messageBundleProps=e._messageBundleProps?e._messageBundleProps.slice():[]),e._messageBundleProps.push({bundlePath:r,propertyName:t})}}var sn=function(r){return{vnodeSelector:"",properties:void 0,children:void 0,text:r.toString(),domNode:null}},kr=function(r,e){for(var t=0,s=r.length;t<s;t++){var i=r[t];Array.isArray(i)?kr(i,e):i!=null&&i!==!1&&(i.hasOwnProperty("vnodeSelector")||(i=sn(i)),e.push(i))}},rn=function(r,e){for(var t=[],s=2;s<arguments.length;s++)t[s-2]=arguments[s];if(t.length===1&&typeof t[0]=="string")return{vnodeSelector:r,properties:e||void 0,children:void 0,text:t[0],domNode:null};var i=[];return kr(t,i),{vnodeSelector:r,properties:e||void 0,children:i,text:void 0,domNode:null}};function N(r,e,...t){return typeof r!="function"||dt(r)?rn(r,e??null,...t):r(e,...t)}const on="calcite-mode-",nn="dark",an="light",ln=/\W/g,cn="--esri-calcite-mode-name";function hn(){return getComputedStyle(document.body).getPropertyValue(cn).replaceAll(ln,"").toLowerCase()}function dn(){const r=hn();switch(r){case nn:case an:return`${on}${r}`;default:return null}}const Tt="esri-identity-modal",Pt={base:Tt,info:`${Tt}__info`,notice:`${Tt}__notice`},un="ArcGIS Online";let R=class extends tn{constructor(r,e){super(r,e),this.container=document.createElement("div"),this.error=null,this.oAuthPrompt=!1,this.open=!1,this.signingIn=!1,this.server=null,this.resource=null,this._usernameInputNode=null,this._passwordInputNode=null,document.body.appendChild(this.container)}loadDependencies(){return zo({button:()=>$e(()=>import("./index-c2fa373c.js"),["assets/index-c2fa373c.js","assets/customElement-de50f949.js","assets/component-825e7090.js","assets/dom-35b95c23.js","assets/interactive-73dc6e50.js","assets/form-39ecb9f1.js","assets/label-f74727ca.js","assets/index-8ee34b61.js","assets/index-a5714ce2.css","assets/sanitizerUtils-d00433fc.js"]),dialog:()=>$e(()=>import("./index-bae029ca.js"),["assets/index-bae029ca.js","assets/customElement-de50f949.js","assets/component-825e7090.js","assets/dom-35b95c23.js","assets/key-8016e4ac.js","assets/interactive-73dc6e50.js","assets/openCloseComponent-3d7fc225.js","assets/index-8ee34b61.js","assets/index-a5714ce2.css","assets/sanitizerUtils-d00433fc.js"]),input:()=>$e(()=>import("./index-abfcfdbf.js"),["assets/index-abfcfdbf.js","assets/component-825e7090.js","assets/dom-35b95c23.js","assets/key-8016e4ac.js","assets/interactive-73dc6e50.js","assets/form-39ecb9f1.js","assets/label-f74727ca.js","assets/index-8ee34b61.js","assets/index-a5714ce2.css","assets/sanitizerUtils-d00433fc.js"]),label:()=>$e(()=>import("./index-2009a064.js"),["assets/index-2009a064.js","assets/label-f74727ca.js","assets/dom-35b95c23.js","assets/index-8ee34b61.js","assets/index-a5714ce2.css","assets/sanitizerUtils-d00433fc.js"]),notice:()=>$e(()=>import("./index-9b562971.js"),["assets/index-9b562971.js","assets/component-825e7090.js","assets/dom-35b95c23.js","assets/openCloseComponent-3d7fc225.js","assets/index-8ee34b61.js","assets/index-a5714ce2.css","assets/sanitizerUtils-d00433fc.js"])})}get title(){return this.commonMessages?.auth.signIn}render(){const{open:r,title:e,messages:t,signingIn:s,oAuthPrompt:i,server:o,resource:n,error:l}=this,{info:a,oAuthInfo:c,lblItem:u,invalidUser:h,noAuthService:d,lblUser:p,lblPwd:v,lblCancel:_,lblSigning:w,lblOk:I}=t;return N("div",{class:this.classes(Pt.base,dn())},N("form",{bind:this,onsubmit:this._submit},N("calcite-dialog",{bind:this,heading:e,modal:!0,open:r,outsideCloseDisabled:!0,scale:"s",widthScale:"s",onCalciteDialogClose:this._cancel,onCalciteDialogOpen:this._focusUsernameInput},N("div",{class:Pt.info},si(i?c:a,{server:o&&/\.arcgis\.com/i.test(o)?un:o,resource:`(${n||u})`})),l?N("calcite-notice",{class:Pt.notice,icon:"exclamation-mark-triangle",kind:"danger",open:!0},N("div",{slot:"message"},l.details?.httpStatus?h:d)):null,i?null:[N("calcite-label",null,p,N("calcite-input",{afterCreate:y=>this._usernameInputNode=y,autocomplete:"off",bind:this,name:"username",required:!0,spellcheck:!1,type:"text",value:""})),N("calcite-label",null,v,N("calcite-input",{afterCreate:y=>this._passwordInputNode=y,bind:this,name:"password",required:!0,type:"password",value:""}))],N("calcite-button",{appearance:"outline",bind:this,onclick:this._cancel,slot:"footer-end",type:"button"},_),N("calcite-button",{loading:!!s,slot:"footer-end",type:"submit"},s?w:I))))}_focusUsernameInput(){return Xo(()=>this._usernameInputNode)}_cancel(){this._set("signingIn",!1),this.open=!1,this._usernameInputNode&&(this._usernameInputNode.value=""),this._passwordInputNode&&(this._passwordInputNode.value=""),this.emit("cancel")}_submit(r){r.preventDefault(),this._set("signingIn",!0);const e=this.oAuthPrompt?{}:{username:this._usernameInputNode?.value,password:this._passwordInputNode?.value};this.emit("submit",e)}};g([m({readOnly:!0})],R.prototype,"container",void 0),g([m(),Ms("esri/t9n/common")],R.prototype,"commonMessages",void 0),g([m()],R.prototype,"error",void 0),g([m(),Ms("esri/identity/t9n/identity")],R.prototype,"messages",void 0),g([m()],R.prototype,"oAuthPrompt",void 0),g([m()],R.prototype,"open",void 0),g([m()],R.prototype,"signingIn",void 0),g([m()],R.prototype,"server",void 0),g([m({readOnly:!0})],R.prototype,"title",null),g([m()],R.prototype,"resource",void 0),R=g([Fe("esri.identity.IdentityModal")],R);const js=R,Et="esriJSAPIOAuth";class Ft{constructor(e,t){this.oAuthInfo=null,this.storage=null,this.appId=null,this.codeVerifier=null,this.expires=null,this.refreshToken=null,this.ssl=null,this.stateUID=null,this.token=null,this.userId=null,this.oAuthInfo=e,this.storage=t,this._init()}isValid(){let e=!1;if(this.oAuthInfo&&this.userId&&(this.refreshToken||this.token)){if(this.expires==null&&this.refreshToken)e=!0;else if(this.expires){const t=Date.now();this.expires>t&&(this.expires-t)/1e3>60*this.oAuthInfo.minTimeUntilExpiration&&(e=!0)}}return e}save(){if(!this.storage)return!1;const e=this._load(),t=this.oAuthInfo;if(t?.authNamespace&&t.portalUrl){let s=e[t.authNamespace];s||(s=e[t.authNamespace]={}),this.appId||(this.appId=t.appId),s[t.portalUrl]={appId:this.appId,codeVerifier:this.codeVerifier,expires:this.expires,refreshToken:this.refreshToken,ssl:this.ssl,stateUID:this.stateUID,token:this.token,userId:this.userId};try{this.storage.setItem(Et,JSON.stringify(e))}catch(i){return console.warn(i),!1}return!0}return!1}destroy(){const e=this._load(),t=this.oAuthInfo;if(t?.appId&&t?.portalUrl&&(this.expires==null||this.expires>Date.now())&&(this.refreshToken||this.token)){const s=t.portalUrl.replace(/^http:/i,"https:")+"/sharing/rest/oauth2/revokeToken",i=new FormData;if(i.append("f","json"),i.append("auth_token",this.refreshToken||this.token),i.append("client_id",t.appId),i.append("token_type_hint",this.refreshToken?"refresh_token":"access_token"),typeof navigator.sendBeacon=="function")navigator.sendBeacon(s,i);else{const o=new XMLHttpRequest;o.open("POST",s),o.send(i)}}if(t?.authNamespace&&t.portalUrl&&this.storage){const s=e[t.authNamespace];if(s){delete s[t.portalUrl];try{this.storage.setItem(Et,JSON.stringify(e))}catch(i){console.log(i)}}}t&&(t._oAuthCred=null,this.oAuthInfo=null)}_init(){const e=this._load(),t=this.oAuthInfo;if(t?.authNamespace&&t.portalUrl){let s=e[t.authNamespace];s&&(s=s[t.portalUrl],s&&(this.appId=s.appId,this.codeVerifier=s.codeVerifier,this.expires=s.expires,this.refreshToken=s.refreshToken,this.ssl=s.ssl,this.stateUID=s.stateUID,this.token=s.token,this.userId=s.userId))}}_load(){let e={};if(this.storage){const t=this.storage.getItem(Et);if(t)try{e=JSON.parse(t)}catch(s){console.warn(s)}}return e}}Ft.prototype.declaredClass="esri.identity.OAuthCredential";var Wt,Ve;let E=(Ve=class extends zs{constructor(e){super(e),this._oAuthCred=null,this.appId=null,this.authNamespace="/",this.expiration=20160,this.flowType="auto",this.forceLogin=!1,this.forceUserId=!1,this.locale=null,this.minTimeUntilExpiration=30,this.popup=!1,this.popupCallbackUrl="oauth-callback.html",this.popupWindowFeatures="height=490,width=800,resizable,scrollbars,status",this.portalUrl="https://www.arcgis.com",this.preserveUrlHash=!1,this.userId=null}clone(){return Wt.fromJSON(this.toJSON())}},Wt=Ve,Ve);g([m({json:{write:!0}})],E.prototype,"appId",void 0),g([m({json:{write:!0}})],E.prototype,"authNamespace",void 0),g([m({json:{write:!0}})],E.prototype,"expiration",void 0),g([m({json:{write:!0}})],E.prototype,"flowType",void 0),g([m({json:{write:!0}})],E.prototype,"forceLogin",void 0),g([m({json:{write:!0}})],E.prototype,"forceUserId",void 0),g([m({json:{write:!0}})],E.prototype,"locale",void 0),g([m({json:{write:!0}})],E.prototype,"minTimeUntilExpiration",void 0),g([m({json:{write:!0}})],E.prototype,"popup",void 0),g([m({json:{write:!0}})],E.prototype,"popupCallbackUrl",void 0),g([m({json:{write:!0}})],E.prototype,"popupWindowFeatures",void 0),g([m({json:{write:!0}})],E.prototype,"portalUrl",void 0),g([m({json:{write:!0}})],E.prototype,"preserveUrlHash",void 0),g([m({json:{write:!0}})],E.prototype,"userId",void 0),E=Wt=g([Fe("esri.identity.OAuthInfo")],E);const Hs=E;let L=class extends zs{constructor(r){super(r),this.adminTokenServiceUrl=null,this.currentVersion=null,this.hasPortal=null,this.hasServer=null,this.owningSystemUrl=null,this.owningTenant=null,this.server=null,this.shortLivedTokenValidity=null,this.tokenServiceUrl=null,this.webTierAuth=null}};g([m({json:{write:!0}})],L.prototype,"adminTokenServiceUrl",void 0),g([m({json:{write:!0}})],L.prototype,"currentVersion",void 0),g([m({json:{write:!0}})],L.prototype,"hasPortal",void 0),g([m({json:{write:!0}})],L.prototype,"hasServer",void 0),g([m({json:{write:!0}})],L.prototype,"owningSystemUrl",void 0),g([m({json:{write:!0}})],L.prototype,"owningTenant",void 0),g([m({json:{write:!0}})],L.prototype,"server",void 0),g([m({json:{write:!0}})],L.prototype,"shortLivedTokenValidity",void 0),g([m({json:{write:!0}})],L.prototype,"tokenServiceUrl",void 0),g([m({json:{write:!0}})],L.prototype,"webTierAuth",void 0),L=g([Fe("esri.identity.ServerInfo")],L);const Ot=L,tt={},Ir=r=>{const e=new Z(r.owningSystemUrl).host,t=new Z(r.server).host,s=/.+\.arcgis\.com$/i;return s.test(e)&&s.test(t)},Jt=(r,e)=>!!(Ir(r)&&e&&e.some(t=>t.test(r.server)));let st=null,rt=null;try{st=window.localStorage,rt=window.sessionStorage}catch{}class Cr extends Gt{constructor(){super(),this._portalConfig=globalThis.esriGeowConfig,this.serverInfos=[],this.oAuthInfos=[],this.credentials=[],this._soReqs=[],this._xoReqs=[],this._portals=[],this._defaultOAuthInfo=null,this._defaultTokenValidity=60,this.dialog=null,this.tokenValidity=null,this.normalizeWebTierAuth=!1,this._appOrigin=window.origin!=="null"?window.origin:window.location.origin,this._appUrlObj=wt(window.location.href),this._busy=null,this._rejectOnPersistedPageShow=!1,this._oAuthLocationParams=null,this._gwTokenUrl="/sharing/rest/generateToken",this._agsRest="/rest/services",this._agsPortal=/\/sharing(\/|$)/i,this._agsAdmin=/(https?:\/\/[^/]+\/[^/]+)\/admin\/?(\/.*)?$/i,this._adminSvcs=/\/rest\/admin\/services(\/|$)/i,this._gwDomains=[{regex:/^https?:\/\/www\.arcgis\.com/i,customBaseUrl:"maps.arcgis.com",tokenServiceUrl:"https://www.arcgis.com/sharing/rest/generateToken"},{regex:/^https?:\/\/(?:dev|[a-z\d-]+\.mapsdev)\.arcgis\.com/i,customBaseUrl:"mapsdev.arcgis.com",tokenServiceUrl:"https://dev.arcgis.com/sharing/rest/generateToken"},{regex:/^https?:\/\/(?:devext|[a-z\d-]+\.mapsdevext)\.arcgis\.com/i,customBaseUrl:"mapsdevext.arcgis.com",tokenServiceUrl:"https://devext.arcgis.com/sharing/rest/generateToken"},{regex:/^https?:\/\/(?:qaext|[a-z\d-]+\.mapsqa)\.arcgis\.com/i,customBaseUrl:"mapsqa.arcgis.com",tokenServiceUrl:"https://qaext.arcgis.com/sharing/rest/generateToken"},{regex:/^https?:\/\/[a-z\d-]+\.maps\.arcgis\.com/i,customBaseUrl:"maps.arcgis.com",tokenServiceUrl:"https://www.arcgis.com/sharing/rest/generateToken"}],this._legacyFed=[],this._regexSDirUrl=/http.+\/rest\/services\/?/gi,this._regexServerType=/(\/(FeatureServer|GPServer|GeoDataServer|GeocodeServer|GeoenrichmentServer|GeometryServer|GlobeServer|ImageServer|KnowledgeGraphServer|MapServer|MissionServer|MobileServer|NAServer|NetworkDiagramServer|OGCFeatureServer|ParcelFabricServer|RelationalCatalogServer|SceneServer|StreamServer|UtilityNetworkServer|ValidationServer|VectorTileServer|VersionManagementServer|VideoServer)).*/gi,this._gwUser=/http.+\/users\/([^/]+).*/i,this._gwItem=/http.+\/items\/([^/]+).*/i,this._gwGroup=/http.+\/groups\/([^/]+).*/i,this._rePortalTokenSvc=/\/sharing(\/rest)?\/generatetoken/i,this._createDefaultOAuthInfo=!0,this._hasTestedIfAppIsOnPortal=!1,this._getPlatformSelfError=null,this._getOAuthLocationParams(),window.addEventListener("pageshow",e=>{this._pageShowHandler(e)})}registerServers(e){const t=this.serverInfos;t?(e=e.filter(s=>!this.findServerInfo(s.server)),this.serverInfos=t.concat(e)):this.serverInfos=e,e.forEach(s=>{s.owningSystemUrl&&this._portals.push(s.owningSystemUrl),s.hasPortal&&this._portals.push(s.server)})}registerOAuthInfos(e){const t=this.oAuthInfos;if(t){for(const s of e){const i=this.findOAuthInfo(s.portalUrl);i&&t.splice(t.indexOf(i),1)}this.oAuthInfos=t.concat(e)}else this.oAuthInfos=e}registerToken(e){e={...e};const t=this._sanitizeUrl(e.server),s=this._isServerRsrc(t);let i,o=this.findServerInfo(t),n=!0;o||(o=new Ot,o.server=this._getServerInstanceRoot(t),s?o.hasServer=!0:(o.tokenServiceUrl=this._getTokenSvcUrl(t),o.hasPortal=!0),this.registerServers([o])),i=this._findCredential(t),i?(delete e.server,Object.assign(i,e),n=!1):(i=new k({userId:e.userId,server:o.server??void 0,token:e.token,expires:e.expires,ssl:e.ssl,scope:s?"server":"portal"}),i.resources=[t],this.credentials.push(i)),i.emitTokenChange(!1),n||i.refreshServerTokens()}toJSON(){return Bs({serverInfos:this.serverInfos.map(e=>e.toJSON()),oAuthInfos:this.oAuthInfos.map(e=>e.toJSON()),credentials:this.credentials.map(e=>e.toJSON())})}initialize(e){if(!e)return;typeof e=="string"&&(e=JSON.parse(e));const t=e.serverInfos,s=e.oAuthInfos,i=e.credentials;if(t){const o=[];t.forEach(n=>{n.server&&n.tokenServiceUrl&&o.push(n.declaredClass?n:new Ot(n))}),o.length&&this.registerServers(o)}if(s){const o=[];s.forEach(n=>{n.appId&&o.push(n.declaredClass?n:new Hs(n))}),o.length&&this.registerOAuthInfos(o)}i&&i.forEach(o=>{o.server&&o.token&&o.expires&&o.expires>Date.now()&&((o=o.declaredClass?o:new k(o)).emitTokenChange(),this.credentials.push(o))})}findServerInfo(e){let t;e=this._sanitizeUrl(e);for(const s of this.serverInfos)if(this._hasSameServerInstance(s.server,e)){t=s;break}return t}findOAuthInfo(e){let t;e=this._sanitizeUrl(e);for(const s of this.oAuthInfos)if(this._hasSameServerInstance(s.portalUrl,e)){t=s;break}return t}findCredential(e,t){if(!e)return;let s;e=this._sanitizeUrl(e);const i=this._isServerRsrc(e)?"server":"portal";if(t){for(const o of this.credentials)if(this._hasSameServerInstance(o.server,e)&&t===o.userId&&o.scope===i){s=o;break}}else for(const o of this.credentials)if(this._hasSameServerInstance(o.server,e)&&this._getIdenticalSvcIdx(e,o)!==-1&&o.scope===i){s=o;break}return s}getCredential(e,t){let s,i=!1,o=!0;t&&(i=!(!t.token&&!t.credential),s=t.error,o=t.prompt!==!1),t={...t},e=this._sanitizeUrl(e);const n=new AbortController,l=Je();if(t.signal&&ke(t.signal,()=>{n.abort()}),ke(n,()=>{l.reject(new T("identity-manager:user-aborted","ABORTED"))}),Qr(n))return l.promise;t.signal=n.signal;const a=this._isAdminResource(e),c=i?this.findCredential(e):null;let u;if(c&&s?.details?.httpStatus===498)c.destroy();else if(c)return u=new T("identity-manager:not-authorized","You are currently signed in as: '"+c.userId+"'. You do not have access to this resource: "+e,{error:s}),l.reject(u),l.promise;const h=this._findCredential(e,t);if(h)return l.resolve(h),l.promise;let d=this.findServerInfo(e);if(d)!d.hasPortal&&d.server&&d.owningSystemUrl&&this._hasSameServerInstance(d.server,d.owningSystemUrl)&&(d.hasPortal=!0),!d.hasServer&&this._isServerRsrc(e)&&(d._restInfoPms=this._getTokenSvcUrl(e),d.hasServer=!0);else{const p=this._getTokenSvcUrl(e);if(!p)return u=new T("identity-manager:unknown-resource","Unknown resource - could not find token service endpoint."),l.reject(u),l.promise;d=new Ot,d.server=this._getServerInstanceRoot(e),typeof p=="string"?(d.tokenServiceUrl=p,d.hasPortal=!0):(d._restInfoPms=p,d.hasServer=!0),this.registerServers([d])}return d.hasPortal&&d._selfReq===void 0&&(o||W(d.tokenServiceUrl,this._appOrigin)||this._gwDomains.some(p=>p.tokenServiceUrl===d.tokenServiceUrl))&&(d._selfReq={owningTenant:t?.owningTenant,selfDfd:this._getPortalSelf(d.tokenServiceUrl.replace(this._rePortalTokenSvc,"/sharing/rest/portals/self"),e)}),this._enqueue(e,d,t,l,a)}getResourceName(e){return this._isRESTService(e)?e.replace(this._regexSDirUrl,"").replace(this._regexServerType,"")||"":this._gwUser.test(e)&&e.replace(this._gwUser,"$1")||this._gwItem.test(e)&&e.replace(this._gwItem,"$1")||this._gwGroup.test(e)&&e.replace(this._gwGroup,"$1")||""}generateToken(e,t,s){const i=this._rePortalTokenSvc.test(e.tokenServiceUrl),o=new Z(this._appOrigin),n=e.shortLivedTokenValidity;let l,a,c,u,h,d,p,v;t&&(v=this.tokenValidity||n||this._defaultTokenValidity,v>n&&n>0&&(v=n)),s&&(l=s.isAdmin,a=s.serverUrl,c=s.token,d=s.signal,p=s.ssl,e.customParameters=s.customParameters),l?u=e.adminTokenServiceUrl:(u=e.tokenServiceUrl,h=new Z(u.toLowerCase()),e.webTierAuth&&s?.serverUrl&&!p&&o.scheme==="http"&&(W(o.uri,u,!0)||h.scheme==="https"&&o.host===h.host&&o.port==="7080"&&h.port==="7443")&&(u=u.replace(/^https:/i,"http:").replace(/:7443/i,":7080")));const _={query:{request:"getToken",username:t?.username,password:t?.password,serverUrl:a,token:c,expiration:v,referer:l||i?this._appOrigin:null,client:l?"referer":null,f:"json",...e.customParameters},method:"post",authMode:"anonymous",useProxy:this._useProxy(e,s),signal:d,...s?.ioArgs};return i||(_.withCredentials=!1),q(u,_).then(w=>{const I=w.data;if(!I?.token)return new T("identity-manager:authentication-failed","Unable to generate token");const y=e.server;return tt[y]||(tt[y]={}),t&&(tt[y][t.username]=t.password),I.validity=v,I})}isBusy(){return!!this._busy}async checkSignInStatus(e){return(await this.checkAppAccess(e,"")).credential}checkAppAccess(e,t,s){let i=!1;return this.getCredential(e,{prompt:!1}).then(o=>{let n;const l={f:"json"};if(o.scope==="portal")if(t&&(this._doPortalSignIn(e)||s?.force))n=o.server+"/sharing/rest/oauth2/validateAppAccess",l.client_id=t;else{if(!o.token)return{credential:o};n=o.server+"/sharing/rest"}else{if(!o.token)return{credential:o};n=o.server+"/rest/services"}return o.token&&(l.token=o.token),q(n,{query:l,authMode:"anonymous"}).then(a=>{if(a.data.valid===!1)throw new T("identity-manager:not-authorized",`You are currently signed in as: '${o.userId}'.`,a.data);return i=!!a.data.viewOnlyUserTypeApp,{credential:o}}).catch(a=>{if(a.name==="identity-manager:not-authorized")throw a;const c=a.details?.httpStatus;if(c===498)throw o.destroy(),new T("identity-manager:not-authenticated","User is not signed in.");if(c===400)throw new T("identity-manager:invalid-request","Bad request");return{credential:o}})}).then(o=>({credential:o.credential,viewOnly:i}))}setOAuthResponseHash(e){e&&(e.charAt(0)==="#"&&(e=e.slice(1)),this._processOAuthPopupParams(Ge(e)))}setOAuthRedirectionHandler(e){this._oAuthRedirectFunc=e}setProtocolErrorHandler(e){this._protocolFunc=e}signIn(e,t,s={}){const i=Je(),o=()=>{a?.remove(),c?.remove(),this.dialog?.destroy(),this.dialog=a=c=null},n=()=>{o(),this._oAuthDfd=null,i.reject(new T("identity-manager:user-aborted","ABORTED"))};s.signal&&ke(s.signal,()=>{n()});const l=new js({open:!0,resource:this.getResourceName(e),server:t.server});this.dialog=l,this.emit("dialog-create");let a=l.on("cancel",n),c=l.on("submit",u=>{this.generateToken(t,u,{isAdmin:s.isAdmin,signal:s.signal}).then(h=>{o();const d=new k({userId:u.username,server:t.server??void 0,token:h.token,expires:h.expires!=null?Number(h.expires):null,ssl:!!h.ssl,isAdmin:s.isAdmin,validity:h.validity});i.resolve(d)}).catch(h=>{l.error=h,l.signingIn=!1})});return i.promise}oAuthSignIn(e,t,s,i){this._oAuthDfd=Je();const o=this._oAuthDfd;let n;i?.signal&&ke(i.signal,()=>{const d=this._oAuthDfd&&this._oAuthDfd.oAuthWin_;d&&!d.closed?d.close():this.dialog&&u()}),o.resUrl_=e,o.sinfo_=t,o.oinfo_=s;const l=s._oAuthCred;if(l.storage&&(s.flowType==="authorization-code"||s.flowType==="auto"&&t.currentVersion>=8.4)){let d=crypto.getRandomValues(new Uint8Array(32));n=St(d),l.codeVerifier=n,d=crypto.getRandomValues(new Uint8Array(32)),l.stateUID=St(d),l.save()||(l.codeVerifier=n=null)}else l.codeVerifier=null;let a,c;this._getCodeChallenge(n).then(d=>{const p=!i||i.oAuthPopupConfirmation!==!1;if(!s.popup||!p)return void this._doOAuthSignIn(e,t,s,d);const v=new js({oAuthPrompt:!0,server:t.server,open:!0});this.dialog=v,this.emit("dialog-create"),a=v.on("cancel",u),c=v.on("submit",()=>{h(),this._doOAuthSignIn(e,t,s,d)})});const u=()=>{h(),this._oAuthDfd=null,o.reject(new T("identity-manager:user-aborted","ABORTED"))},h=()=>{a?.remove(),c?.remove(),this.dialog?.destroy(),this.dialog=null};return o.promise}destroyCredentials(){this.credentials&&this.credentials.slice().forEach(e=>{e.destroy()}),this.emit("credentials-destroy")}enablePostMessageAuth(e="https://www.arcgis.com/sharing/rest"){this._postMessageAuthHandle&&this._postMessageAuthHandle.remove(),this._postMessageAuthHandle=Ye(window,"message",t=>{if((t.origin===this._appOrigin||t.origin.endsWith(".arcgis.com"))&&t.data?.type==="arcgis:auth:requestCredential"){const s=t.source;this.getCredential(e).then(i=>{s.postMessage({type:"arcgis:auth:credential",credential:{expires:i.expires,server:i.server,ssl:i.ssl,token:i.token,userId:i.userId}},t.origin)}).catch(i=>{s.postMessage({type:"arcgis:auth:error",error:{name:i.name,message:i.message}},t.origin)})}})}disablePostMessageAuth(){this._postMessageAuthHandle&&(this._postMessageAuthHandle.remove(),this._postMessageAuthHandle=null)}_getOAuthLocationParams(){let e=window.location.hash;if(e){e.charAt(0)==="#"&&(e=e.slice(1));const s=Ge(e);let i=!1;if(s.access_token&&s.expires_in&&s.state&&s.hasOwnProperty("username"))try{s.state=JSON.parse(s.state),s.state.portalUrl&&(this._oAuthLocationParams=s,i=!0)}catch{}else if(s.error&&s.error_description&&(console.log("IdentityManager OAuth Error: ",s.error," - ",s.error_description),s.error==="access_denied"&&(i=!0,s.state)))try{s.state=JSON.parse(s.state)}catch{}i&&(window.location.hash=s.state?.hash||"")}let t=window.location.search;if(t){t.charAt(0)==="?"&&(t=t.slice(1));const s=Ge(t);let i=!1;if(s.code&&s.state)try{s.state=JSON.parse(s.state),s.state.portalUrl&&s.state.uid&&(this._oAuthLocationParams=s,i=!0)}catch{}else if(s.error&&s.error_description&&(console.log("IdentityManager OAuth Error: ",s.error," - ",s.error_description),s.error==="access_denied"&&(i=!0,s.state)))try{s.state=JSON.parse(s.state)}catch{}if(i){const o={...s};["code","error","error_description","message_code","persist","state"].forEach(a=>{delete o[a]});const n=us(o),l=window.location.pathname+(n?`?${n}`:"")+(s.state?.hash||"");window.history.replaceState(window.history.state,"",l)}}}_getOAuthToken(e,t,s,i,o){return e=e.replace(/^http:/i,"https:"),q(`${e}/sharing/rest/oauth2/token`,{authMode:"anonymous",method:"post",query:i&&o?{grant_type:"authorization_code",code:t,redirect_uri:i,client_id:s,code_verifier:o}:{grant_type:"refresh_token",refresh_token:t,client_id:s}}).then(n=>n.data)}async _getCodeChallenge(e){if(e&&globalThis.isSecureContext){const t=new TextEncoder().encode(e),s=await crypto.subtle.digest("SHA-256",t);return St(new Uint8Array(s))}return null}_pageShowHandler(e){if(e.persisted&&this.isBusy()&&this._rejectOnPersistedPageShow){const t=new T("identity-manager:user-aborted","ABORTED");this._errbackFunc(t)}}_findCredential(e,t){let s,i,o,n,l=-1;const a=t?.token,c=t?.resource,u=this._isServerRsrc(e)?"server":"portal",h=this.credentials.filter(d=>this._hasSameServerInstance(d.server,e)&&d.scope===u);if(e=c||e,h.length)if(h.length===1){if(s=h[0],o=this.findServerInfo(s.server),i=o?.owningSystemUrl,n=i?this.findCredential(i,s.userId):void 0,l=this._getIdenticalSvcIdx(e,s),!a)return l===-1&&s.resources.push(e),this._addResource(e,n),s;l!==-1&&(s.resources.splice(l,1),this._removeResource(e,n))}else{let d,p;if(h.some(v=>(p=this._getIdenticalSvcIdx(e,v),p!==-1&&(d=v,o=this.findServerInfo(d.server),i=o?.owningSystemUrl,n=i?this.findCredential(i,d.userId):void 0,l=p,!0))),a)d&&(d.resources.splice(l,1),this._removeResource(e,n));else if(d)return this._addResource(e,n),d}}_findOAuthInfo(e){let t=this.findOAuthInfo(e);if(!t){for(const s of this.oAuthInfos)if(this._isIdProvider(s.portalUrl,e)){t=s;break}}return t}_addResource(e,t){t&&this._getIdenticalSvcIdx(e,t)===-1&&t.resources.push(e)}_removeResource(e,t){let s=-1;t&&(s=this._getIdenticalSvcIdx(e,t),s>-1&&t.resources.splice(s,1))}_useProxy(e,t){return t?.isAdmin&&!W(e.adminTokenServiceUrl,this._appOrigin)||!this._isPortalDomain(e.tokenServiceUrl)&&String(e.currentVersion)==="10.1"&&!W(e.tokenServiceUrl,this._appOrigin)}_getOrigin(e){const t=new Z(e);return t.scheme+"://"+t.host+(t.port!=null?":"+t.port:"")}_getServerInstanceRoot(e){const t=e.toLowerCase();let s=t.indexOf(this._agsRest);return s===-1&&this._isAdminResource(e)&&(s=this._agsAdmin.test(e)?e.replace(this._agsAdmin,"$1").length:e.search(this._adminSvcs)),s!==-1||Yr(t)||(s=t.indexOf("/sharing")),s===-1&&t.endsWith("/")&&(s=t.length-1),s>-1?e.slice(0,s):e}_hasSameServerInstance(e,t){return e.endsWith("/")&&(e=e.slice(0,-1)),e=e.toLowerCase(),t=this._getServerInstanceRoot(t).toLowerCase(),e=ps(e),t=ps(t),(e=e.slice(Math.max(0,e.indexOf(":"))))===(t=t.slice(Math.max(0,t.indexOf(":"))))}_sanitizeUrl(e){const t=(At.request.proxyUrl||"").toLowerCase(),s=t?e.toLowerCase().indexOf(t+"?"):-1;return s!==-1&&(e=e.slice(s+t.length+1)),e=Xr(e),wt(e).path}_isRESTService(e){return e.includes(this._agsRest)}_isAdminResource(e){return this._agsAdmin.test(e)||this._adminSvcs.test(e)}_isServerRsrc(e){return this._isRESTService(e)||this._isAdminResource(e)}_isIdenticalService(e,t){let s=!1;if(this._isRESTService(e)&&this._isRESTService(t)){const i=this._getSuffix(e).toLowerCase(),o=this._getSuffix(t).toLowerCase();if(s=i===o,!s){const n=/(.*)\/(MapServer|FeatureServer|UtilityNetworkServer).*/gi;s=i.replaceAll(n,"$1")===o.replaceAll(n,"$1")}}else this._isAdminResource(e)&&this._isAdminResource(t)?s=!0:this._isServerRsrc(e)||this._isServerRsrc(t)||!this._isPortalDomain(e)||(s=!0);return s}_isPortalDomain(e){const t=new Z(e.toLowerCase()),s=this._portalConfig;let i=this._gwDomains.some(o=>o.regex.test(t.uri));return!i&&s&&(i=this._hasSameServerInstance(this._getServerInstanceRoot(s.restBaseUrl),t.uri)),i||At.portalUrl&&(i=W(t,At.portalUrl,!0)),i||(i=this._portals.some(o=>this._hasSameServerInstance(o,t.uri))),i=i||this._agsPortal.test(t.path),i}_isIdProvider(e,t){let s=-1,i=-1;this._gwDomains.forEach((n,l)=>{s===-1&&n.regex.test(e)&&(s=l),i===-1&&n.regex.test(t)&&(i=l)});let o=!1;if(s>-1&&i>-1&&(s===0||s===4?i!==0&&i!==4||(o=!0):s===1?i!==1&&i!==2||(o=!0):s===2?i===2&&(o=!0):s===3&&i===3&&(o=!0)),!o){const n=this.findServerInfo(t),l=n?.owningSystemUrl;l&&Ir(n)&&this._isPortalDomain(l)&&this._isIdProvider(e,l)&&(o=!0)}return o}_getIdenticalSvcIdx(e,t){let s=-1;for(let i=0;i<t.resources.length;i++){const o=t.resources[i];if(this._isIdenticalService(e,o)){s=i;break}}return s}_getSuffix(e){return e.replace(this._regexSDirUrl,"").replace(this._regexServerType,"$1")}_getTokenSvcUrl(e){let t,s,i;if(this._isRESTService(e)||this._isAdminResource(e)){const o=this._getServerInstanceRoot(e);return t=o+"/admin/generateToken",s=q(e=o+"/rest/info",{query:{f:"json"}}).then(n=>n.data),{adminUrl:t,promise:s}}if(this._isPortalDomain(e)){let o="";if(this._gwDomains.some(n=>(n.regex.test(e)&&(o=n.tokenServiceUrl),!!o)),o||this._portals.some(n=>(this._hasSameServerInstance(n,e)&&(o=n+this._gwTokenUrl),!!o)),o||(i=e.toLowerCase().indexOf("/sharing"),i!==-1&&(o=e.slice(0,i)+this._gwTokenUrl)),o||(o=this._getOrigin(e)+this._gwTokenUrl),o){const n=new Z(e).port;/^http:\/\//i.test(e)&&n==="7080"&&(o=o.replace(/:7080/i,":7443")),o=o.replace(/http:/i,"https:")}return o}}_processOAuthResponseParams(e,t,s){const i=t._oAuthCred;if(e.code){const n=i.codeVerifier;return i.codeVerifier=null,i.stateUID=null,i.save(),this._getOAuthToken(s.server,e.code,t.appId,this._getRedirectURI(t,!0),n).then(l=>{const a=new k({userId:l.username,server:s.server??void 0,token:l.access_token,expires:Date.now()+1e3*l.expires_in,ssl:l.ssl,oAuthState:e.state,_oAuthCred:i});return t.userId=a.userId,i.storage=l.persist?st:rt,i.refreshToken=l.refresh_token,i.token=null,i.expires=l.refresh_token_expires_in?Date.now()+1e3*l.refresh_token_expires_in:null,i.userId=a.userId,i.ssl=a.ssl,i.save(),a})}const o=new k({userId:e.username,server:s.server??void 0,token:e.access_token,expires:Date.now()+1e3*Number(e.expires_in),ssl:e.ssl==="true",oAuthState:e.state,_oAuthCred:i});return t.userId=o.userId,i.storage=e.persist?st:rt,i.refreshToken=null,i.token=o.token,i.expires=o.expires,i.userId=o.userId,i.ssl=o.ssl,i.save(),Promise.resolve(o)}_processOAuthPopupParams(e){const t=this._oAuthDfd;if(this._oAuthDfd=null,t)if(clearInterval(this._oAuthIntervalId),this._oAuthOnPopupHandle?.remove(),e.error){const s=e.error==="access_denied",i=new T(s?"identity-manager:user-aborted":"identity-manager:authentication-failed",s?"ABORTED":"OAuth: "+e.error+" - "+e.error_description);t.reject(i)}else this._processOAuthResponseParams(e,t.oinfo_,t.sinfo_).then(s=>{t.resolve(s)}).catch(s=>{t.reject(s)})}_setOAuthResponseQueryString(e){e&&(e.charAt(0)==="?"&&(e=e.slice(1)),this._processOAuthPopupParams(Ge(e)))}async _exchangeToken(e,t,s){return(await q(`${e}/sharing/rest/oauth2/exchangeToken`,{authMode:"anonymous",method:"post",query:{f:"json",client_id:t,token:s}})).data.token}async _getPlatformSelf(e,t){if(this._getPlatformSelfError&&Date.now()-this._getPlatformSelfError[1]<1e3)throw this._getPlatformSelfError[0];e=e.replace(/^http:/i,"https:");try{const s=await q(`${e}/sharing/rest/oauth2/platformSelf`,{authMode:"anonymous",headers:{"X-Esri-Auth-Client-Id":t,"X-Esri-Auth-Redirect-Uri":window.location.href.replace(/#.*$/,"")},method:"post",query:{f:"json",expiration:30},withCredentials:!0});return this._getPlatformSelfError=null,s.data}catch(s){throw s.details?.messageCode==="OAUTH_0066"&&(this._getPlatformSelfError=[s,Date.now()]),s}}_getPortalSelf(e,t){let s;return this._gwDomains.some(i=>(i.regex.test(e)&&(s=i.customBaseUrl),!!s)),s?Promise.resolve({allSSL:!0,currentVersion:"8.4",customBaseUrl:s,portalMode:"multitenant",supportsOAuth:!0}):(this._appOrigin.startsWith("https:")?e=e.replace(/^http:/i,"https:").replace(/:7080/i,":7443"):/^http:/i.test(t)&&(e=e.replace(/^https:/i,"http:").replace(/:7443/i,":7080")),q(e,{query:{f:"json"},authMode:"anonymous",withCredentials:!0}).then(i=>i.data))}_doPortalSignIn(e){const t=this._portalConfig,s=window.location.href,i=this.findServerInfo(e);return!(!t&&!this._isPortalDomain(s)||!(i?i.hasPortal||i.owningSystemUrl&&this._isPortalDomain(i.owningSystemUrl):this._isPortalDomain(e))||!(this._isIdProvider(s,e)||t&&(this._hasSameServerInstance(this._getServerInstanceRoot(t.restBaseUrl),e)||this._isIdProvider(t.restBaseUrl,e))||W(s,e,!0)))}_checkProtocol(e,t,s,i){let o=!0;const n=i?t.adminTokenServiceUrl:t.tokenServiceUrl;return n.trim().toLowerCase().startsWith("https:")&&!this._appOrigin.startsWith("https:")&&Zr(n)&&(o=!!this._protocolFunc&&!!this._protocolFunc({resourceUrl:e,serverInfo:t}),!o)&&s(new T("identity-manager:aborted","Aborted the Sign-In process to avoid sending password over insecure connection.")),o}_enqueue(e,t,s,i,o,n){return i||(i=Je()),i.resUrl_=e,i.sinfo_=t,i.options_=s,i.admin_=o,i.refresh_=n,this._busy?this._hasSameServerInstance(this._getServerInstanceRoot(e),this._busy.resUrl_)?(this._oAuthDfd&&this._oAuthDfd.oAuthWin_&&this._oAuthDfd.oAuthWin_.focus(),this._soReqs.push(i)):this._xoReqs.push(i):this._doSignIn(i),i.promise}_doSignIn(e){this._busy=e,this._rejectOnPersistedPageShow=!1;const t=c=>{const u=e.options_?.resource,h=e.resUrl_,d=e.refresh_;let p=!1;this.credentials.includes(c)||(d&&this.credentials.includes(d)?(d.userId=c.userId,d.token=c.token,d.expires=c.expires,d.validity=c.validity,d.ssl=c.ssl,d.creationTime=c.creationTime,p=!0,c=d):this.credentials.push(c)),c.resources||(c.resources=[]),c.resources.includes(u||h)||c.resources.push(u||h),c.scope=this._isServerRsrc(h)?"server":"portal",c.emitTokenChange();const v=this._soReqs,_={};this._soReqs=[],v.forEach(w=>{if(!this._isIdenticalService(h,w.resUrl_)){const I=this._getSuffix(w.resUrl_);_[I]||(_[I]=!0,c.resources.push(w.resUrl_))}}),e.resolve(c),v.forEach(w=>{this._hasSameServerInstance(this._getServerInstanceRoot(h),w.resUrl_)?w.resolve(c):this._soReqs.push(w)}),this._busy=e.resUrl_=e.sinfo_=e.refresh_=null,p||this.emit("credential-create",{credential:c}),this._soReqs.length?this._doSignIn(this._soReqs.shift()):this._xoReqs.length&&this._doSignIn(this._xoReqs.shift())},s=c=>{e.reject(c),this._busy=e.resUrl_=e.sinfo_=e.refresh_=null,this._soReqs.length?this._doSignIn(this._soReqs.shift()):this._xoReqs.length&&this._doSignIn(this._xoReqs.shift())},i=(c,u,h,d)=>{const p=e.sinfo_,v=!e.options_||e.options_.prompt!==!1,_=p.hasPortal&&this._findOAuthInfo(e.resUrl_);let w,I;if(c)t(new k({userId:c,server:p.server??void 0,token:h??void 0,expires:d!=null?Number(d):null,ssl:!!u}));else if(window!==window.parent&&this._appUrlObj.query?.["arcgis-auth-origin"]&&this._appUrlObj.query?.["arcgis-auth-portal"]&&this._hasSameServerInstance(this._getServerInstanceRoot(this._appUrlObj.query["arcgis-auth-portal"]),e.resUrl_)){window.parent.postMessage({type:"arcgis:auth:requestCredential"},this._appUrlObj.query["arcgis-auth-origin"]);const y=Ye(window,"message",$=>{$.source===window.parent&&$.data&&($.data.type==="arcgis:auth:credential"?(y.remove(),$.data.credential.expires<Date.now()?s(new T("identity-manager:credential-request-failed","Parent application's token has expired.")):t(new k($.data.credential))):$.data.type==="arcgis:auth:error"&&(y.remove(),$.data.error.name==="tokenExpiredError"?s(new T("identity-manager:credential-request-failed","Parent application's token has expired.")):s(T.fromJSON($.data.error))))});ke(e.options_?.signal,()=>{y.remove()})}else if(_){let y=_._oAuthCred;if(!y){const $=new Ft(_,st),b=new Ft(_,rt);$.isValid()&&b.isValid()?$.expires>b.expires?(y=$,b.destroy()):(y=b,$.destroy()):y=$.isValid()?$:b,_._oAuthCred=y}if(y.isValid()){w=new k({userId:y.userId??void 0,server:p.server??void 0,token:y.token??void 0,expires:y.expires,ssl:y.ssl??void 0,_oAuthCred:y});const $=_.appId!==y.appId&&this._doPortalSignIn(e.resUrl_);$||y.refreshToken?(e._pendingDfd=y.refreshToken?this._getOAuthToken(p.server,y.refreshToken,y.appId).then(b=>(w.expires=Date.now()+1e3*b.expires_in,w.token=b.access_token,w)):Promise.resolve(w),e._pendingDfd.then(b=>$?this._exchangeToken(b.server,_.appId,b.token).then(D=>(b.token=D,b)).catch(()=>b):b).then(b=>{t(b)}).catch(b=>{const D=b.details?.httpStatus;D>0&&D!==404?(y.destroy(),i()):s(b)})):t(w)}else if(this._oAuthLocationParams&&this._hasSameServerInstance(_.portalUrl,this._oAuthLocationParams.state.portalUrl)&&(this._oAuthLocationParams.access_token||this._oAuthLocationParams.code&&this._oAuthLocationParams.state.uid===y.stateUID&&y.codeVerifier)){const $=this._oAuthLocationParams;this._oAuthLocationParams=null,e._pendingDfd=this._processOAuthResponseParams($,_,p).then(b=>{t(b)}).catch(s)}else{const $=()=>{v?e._pendingDfd=this.oAuthSignIn(e.resUrl_,p,_,e.options_).then(t,s):(I=new T("identity-manager:not-authenticated","User is not signed in."),s(I))};this._doPortalSignIn(e.resUrl_)?e._pendingDfd=this._getPlatformSelf(p.server,_.appId).then(b=>{W(b.portalUrl,this._appOrigin,!0)?(w=new k({userId:b.username,server:p.server??void 0,expires:Date.now()+1e3*b.expires_in,token:b.token}),t(w)):$()}).catch($):$()}}else if(v){if(this._checkProtocol(e.resUrl_,p,s,e.admin_)){let y=e.options_;e.admin_&&(y=y||{},y.isAdmin=!0),e._pendingDfd=this.signIn(e.resUrl_,p,y).then(t,s)}}else I=new T("identity-manager:not-authenticated","User is not signed in."),s(I)},o=()=>{const c=e.sinfo_,u=c.owningSystemUrl,h=e.options_;let d,p,v,_;if(h&&(d=h.token,p=h.error,v=h.prompt),_=this._findCredential(u,{token:d,resource:e.resUrl_}),!_){for(const w of this.credentials)if(this._isIdProvider(u,w.server)){_=w;break}}if(_){const w=this.findCredential(e.resUrl_,_.userId);if(w)t(w);else if(Jt(c,this._legacyFed)){const I=_.toJSON();I.server=c.server,I.resources=null,t(new k(I))}else(e._pendingDfd=this.generateToken(this.findServerInfo(_.server),null,{serverUrl:e.resUrl_,token:_.token,signal:e.options_.signal,ssl:_.ssl})).then(I=>{t(new k({userId:_?.userId,server:c.server??void 0,token:I.token,expires:I.expires!=null?Number(I.expires):null,ssl:!!I.ssl,isAdmin:e.admin_,validity:I.validity}))},s)}else this._busy=null,d&&(e.options_.token=null),(e._pendingDfd=this.getCredential(u.replace(/\/?$/,"/sharing"),{resource:e.resUrl_,owningTenant:c.owningTenant,signal:e.options_.signal,token:d,error:p,prompt:v})).then(()=>{this._enqueue(e.resUrl_,e.sinfo_,e.options_,e,e.admin_)},w=>{e.resUrl_=e.sinfo_=e.refresh_=null,e.reject(w)})};this._errbackFunc=s;const n=e.sinfo_.owningSystemUrl,l=this._isServerRsrc(e.resUrl_),a=e.sinfo_._restInfoPms;a?a.promise.then(c=>{const u=e.sinfo_;if(u._restInfoPms){u.adminTokenServiceUrl=u._restInfoPms.adminUrl,u._restInfoPms=null,u.tokenServiceUrl=(Te("authInfo.tokenServicesUrl",c)||Te("authInfo.tokenServiceUrl",c)||Te("tokenServiceUrl",c))??null,u.shortLivedTokenValidity=Te("authInfo.shortLivedTokenValidity",c)??null,u.currentVersion=c.currentVersion,u.owningTenant=c.owningTenant;const h=u.owningSystemUrl=c.owningSystemUrl;h&&this._portals.push(h)}l&&u.owningSystemUrl?o():i()},()=>{e.sinfo_._restInfoPms=null;const c=new T("identity-manager:server-identification-failed","Unknown resource - could not find token service endpoint.");s(c)}):l&&n?o():e.sinfo_._selfReq?e.sinfo_._selfReq.selfDfd.then(c=>{const u={};let h,d,p,v;return c&&(h=c.user?.username,u.username=h,u.allSSL=c.allSSL,d=c.supportsOAuth,v=parseFloat(c.currentVersion),c.portalMode==="multitenant"&&(p=c.customBaseUrl),e.sinfo_.currentVersion=v),e.sinfo_.webTierAuth=!!h,h&&this.normalizeWebTierAuth?this.generateToken(e.sinfo_,null,{ssl:u.allSSL}).catch(()=>null).then(_=>(u.portalToken=_?.token,u.tokenExpiration=_?.expires,u)):!h&&d&&v>=4.4&&!this._findOAuthInfo(e.resUrl_)?this._generateOAuthInfo({portalUrl:e.sinfo_.server,customBaseUrl:p,owningTenant:e.sinfo_._selfReq.owningTenant}).catch(()=>null).then(()=>u):u}).catch(()=>null).then(c=>{e.sinfo_._selfReq=null,c?i(c.username,c.allSSL,c.portalToken,c.tokenExpiration):i()}):i()}_generateOAuthInfo(e){let t,s=null,i=e.portalUrl;const o=e.customBaseUrl,n=e.owningTenant,l=!this._defaultOAuthInfo&&this._createDefaultOAuthInfo&&!this._hasTestedIfAppIsOnPortal;if(l){s=this._appUrlObj.path;const a=s.search(/\/(apps|home)\//);s=a>-1?s.slice(0,a):null}return l&&s?(this._hasTestedIfAppIsOnPortal=!0,t=q(s+"/sharing/rest",{query:{f:"json"}}).then(()=>{this._defaultOAuthInfo=new Hs({appId:"arcgisonline",popupCallbackUrl:s+"/home/oauth-callback.html"})})):t=Promise.resolve(),t.then(()=>{if(this._defaultOAuthInfo)return i=i.replace(/^http:/i,"https:"),q(i+"/sharing/rest/oauth2/validateRedirectUri",{query:{accountId:n,client_id:this._defaultOAuthInfo.appId,redirect_uri:Rt(this._defaultOAuthInfo.popupCallbackUrl),f:"json"}}).then(a=>{if(a.data.valid){const c=this._defaultOAuthInfo.clone();a.data.urlKey&&o?c.portalUrl="https://"+a.data.urlKey.toLowerCase()+"."+o:c.portalUrl=i,c.popup=window!==window.top||!(W(i,this._appOrigin)||this._gwDomains.some(u=>u.regex.test(i)&&u.regex.test(this._appOrigin))),this.oAuthInfos.push(c)}})})}_doOAuthSignIn(e,t,s,i){const o=s._oAuthCred,n={portalUrl:s.portalUrl};!s.popup&&s.preserveUrlHash&&window.location.hash&&(n.hash=window.location.hash),o.stateUID&&(n.uid=o.stateUID);const l={client_id:s.appId,response_type:o.codeVerifier?"code":"token",state:JSON.stringify(n),expiration:s.expiration,locale:s.locale,redirect_uri:this._getRedirectURI(s,!!o.codeVerifier)};s.forceLogin&&(l.force_login=!0),s.forceUserId&&s.userId&&(l.prepopulatedusername=s.userId),!s.popup&&this._doPortalSignIn(e)&&(l.redirectToUserOrgUrl=!0),o.codeVerifier&&(l.code_challenge=i||o.codeVerifier,l.code_challenge_method=i?"S256":"plain");const a=s.portalUrl.replace(/^http:/i,"https:")+"/sharing/oauth2/authorize",c=a+"?"+us(l);if(s.popup){const u=window.open(c,"esriJSAPIOAuth",s.popupWindowFeatures);if(u)u.focus(),this._oAuthDfd.oAuthWin_=u,this._oAuthIntervalId=setInterval(()=>{if(u.closed){clearInterval(this._oAuthIntervalId),this._oAuthOnPopupHandle.remove();const h=this._oAuthDfd;if(h){const d=new T("identity-manager:user-aborted","ABORTED");h.reject(d)}}},500),this._oAuthOnPopupHandle=Ye(window,["arcgis:auth:hash","arcgis:auth:location:search"],h=>{h.type==="arcgis:auth:hash"?this.setOAuthResponseHash(h.detail):this._setOAuthResponseQueryString(h.detail)});else{const h=new T("identity-manager:popup-blocked","ABORTED");this._oAuthDfd.reject(h)}}else this._rejectOnPersistedPageShow=!0,this._oAuthRedirectFunc?this._oAuthRedirectFunc({authorizeParams:l,authorizeUrl:a,resourceUrl:e,serverInfo:t,oAuthInfo:s}):window.location.href=c}_getRedirectURI(e,t){const s=window.location.href.replace(/#.*$/,"");if(e.popup)return Rt(e.popupCallbackUrl);if(t){const i=wt(s);return i.query&&["code","error","error_description","message_code","persist","state"].forEach(o=>{delete i.query[o]}),ei(i.path,i.query)}return s}}Cr.prototype.declaredClass="esri.identity.IdentityManagerBase";let k=class extends Gt.EventedAccessor{constructor(r){super(r),this._oAuthCred=null,this.tokenRefreshBuffer=2,r?._oAuthCred&&(this._oAuthCred=r._oAuthCred)}initialize(){this.resources=this.resources||[],this.creationTime==null&&(this.creationTime=Date.now())}refreshToken(){const r=Ke,e=r.findServerInfo(this.server),t=e?.owningSystemUrl,s=!!t&&this.scope==="server",i=s&&Jt(e,r._legacyFed),o=e.webTierAuth,n=o&&r.normalizeWebTierAuth,l=tt[this.server],a=l?.[this.userId];let c,u=this.resources&&this.resources[0],h=s?r.findServerInfo(t):null,d={username:this.userId,password:a};if(o&&!n)return;s&&!h&&r.serverInfos.some(v=>(r._isIdProvider(t,v.server)&&(h=v),!!h));const p=h?r.findCredential(h.server,this.userId):null;if(!s||p){if(!i){if(s)c={serverUrl:u,token:p?.token,ssl:p?.ssl};else if(n)d=null,c={ssl:this.ssl};else{if(!a){let v;return u&&(u=r._sanitizeUrl(u),this._enqueued=1,v=r._enqueue(u,e,null,null,this.isAdmin,this),v.then(()=>{this._enqueued=0,this.refreshServerTokens()}).catch(()=>{this._enqueued=0})),v}this.isAdmin&&(c={isAdmin:!0})}return r.generateToken(s?h:e,s?null:d,c).then(v=>{this.token=v.token,this.expires=v.expires!=null?Number(v.expires):null,this.creationTime=Date.now(),this.validity=v.validity,this.emitTokenChange(),this.refreshServerTokens()}).catch(()=>{})}p?.refreshToken()}}refreshServerTokens(){if(this.scope==="portal"){const r=Ke;r.credentials.forEach(e=>{const t=r.findServerInfo(e.server),s=t?.owningSystemUrl;e!==this&&e.userId===this.userId&&s&&e.scope==="server"&&(r._hasSameServerInstance(this.server,s)||r._isIdProvider(s,this.server))&&(Jt(t,r._legacyFed)?(e.token=this.token,e.expires=this.expires,e.creationTime=this.creationTime,e.validity=this.validity,e.emitTokenChange()):e.refreshToken())})}}emitTokenChange(r){clearTimeout(this._refreshTimer);const e=Ke,t=this.server?e.findServerInfo(this.server):null,s=t?.owningSystemUrl,i=s?e.findServerInfo(s):null;r===!1||s&&this.scope!=="portal"&&(!i?.webTierAuth||e.normalizeWebTierAuth)||this.expires==null&&this.validity==null||this._startRefreshTimer(),this.emit("token-change")}destroy(){this.userId=this.server=this.token=this.expires=this.validity=this.resources=this.creationTime=null,this._oAuthCred&&(this._oAuthCred.destroy(),this._oAuthCred=null);const r=Ke,e=r.credentials.indexOf(this);e>-1&&r.credentials.splice(e,1),this.emitTokenChange(),this.emit("destroy")}toJSON(){const r=Bs({userId:this.userId,server:this.server,token:this.token,expires:this.expires,validity:this.validity,ssl:this.ssl,isAdmin:this.isAdmin,creationTime:this.creationTime,scope:this.scope}),e=this.resources;return e&&e.length>0&&(r.resources=e.slice()),r}_startRefreshTimer(){clearTimeout(this._refreshTimer);const r=6e4*this.tokenRefreshBuffer,e=2**31-1;let t=(this.validity?this.creationTime+6e4*this.validity:this.expires)-Date.now();t<0?t=0:t>e&&(t=e),this._refreshTimer=setTimeout(this.refreshToken.bind(this),t>r?t-r:t)}};g([m()],k.prototype,"creationTime",void 0),g([m()],k.prototype,"expires",void 0),g([m()],k.prototype,"isAdmin",void 0),g([m()],k.prototype,"oAuthState",void 0),g([m()],k.prototype,"resources",void 0),g([m()],k.prototype,"scope",void 0),g([m()],k.prototype,"server",void 0),g([m()],k.prototype,"ssl",void 0),g([m()],k.prototype,"token",void 0),g([m()],k.prototype,"tokenRefreshBuffer",void 0),g([m()],k.prototype,"userId",void 0),g([m()],k.prototype,"validity",void 0),k=g([Fe("esri.identity.Credential")],k);class Ur extends Cr{}Ur.prototype.declaredClass="esri.identity.IdentityManager";const Tr=new Ur;ti(Tr);const zn=Object.freeze(Object.defineProperty({__proto__:null,default:Tr},Symbol.toStringTag,{value:"Module"}));export{Nn as A,Ln as C,Dn as D,U as E,zn as I,xs as L,Q as T,Pn as a,Un as b,Hn as c,xn as d,En as e,Sn as f,hr as g,dr as h,_n as i,oo as j,In as k,po as l,Cn as m,go as n,Ti as o,mn as p,Ee as q,no as r,Rn as s,cr as t,kn as u,qn as v,jn as w,wn as x,On as y,Mn as z};
