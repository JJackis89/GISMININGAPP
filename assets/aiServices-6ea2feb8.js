import{dV as _,dW as F,bs as Ke,M as q,d4 as Xe,hW as ae,e2 as P,iM as Le,iL as Me,dZ as v,d$ as b,dX as We,e5 as Qe,e8 as W,cX as S,d_ as h,P as de,N as ye,O as pe,z as he,e0 as G,bV as Pe,jz as et,az as tt,jA as nt,jB as rt,f as st,k as it,r as w,m as x,a as me,l as ge,jC as at,g as ot,s as lt,H as ut,p as ct,am as ft,C as dt,bY as yt}from"./index-f00bd99f.js";import{l as pt,p as ht}from"./number-45d97d9b.js";import{t as mt}from"./commonProperties-da958896.js";function gt(e){if(typeof e=="string")return e.toLowerCase();if("name"in e)return e.name.toLowerCase();if(typeof e.value!="string")throw new _(null,F.InvalidIdentifier,null);return e.value.toLowerCase()}const an=Object.freeze({aborted:!1});let be=class{};class E{constructor(){}}function ke(e,t,n){if(e instanceof E&&!(e instanceof oe)){const s=new oe;return s.fn=e,s.parameterEvaluator=n,s.context=t,s}return e}let ln=class extends E{constructor(t){super(),this.fn=t}createFunction(t){return(...n)=>this.fn(t,{preparsed:!0,arguments:n})}call(t,n){return this.fn(t,n)}marshalledCall(t,n,s,r){return r(t,n,(i,o,a)=>{a=a.map(c=>c instanceof E&&!(c instanceof oe)?ke(c,t,r):c);const u=this.call(s,{args:a});return Ke(u)?u.then(c=>ke(c,s,r)):u})}},oe=class extends E{constructor(){super(...arguments),this.fn=null,this.context=null}createFunction(t){return this.fn.createFunction(this.context)}call(t,n){return this.fn.marshalledCall(t,n,this.context,this.parameterEvaluator)}marshalledCall(t,n,s){return this.fn.marshalledCall(t,n,this.context,this.parameterEvaluator)}};class J{constructor(t=[]){this._elements=t}length(){return this._elements.length}get(t){return this._elements[t]}toArray(){return this.slice()}slice(t=0,n=this.length()){const s=[];for(let r=t;r<n;r++)s.push(this.get(r));return s}}let H=class Ge extends J{constructor(t,n,s,r,i,o){super(t),this._lazyPt=[],this._hasZ=!1,this._hasM=!1,this._spRef=n,this._hasZ=s,this._hasM=r,this._cacheId=i,this._partId=o}get(t){if(this._lazyPt[t]===void 0){const n=this._elements[t];if(n===void 0)return;const s=new q(n[0],n[1],this._spRef);this._hasZ&&(s.z=n[2]),this._hasM&&(s.m=this._hasZ?n[3]:n[2]),s.cache._arcadeCacheId=this._cacheId.toString()+"-"+this._partId.toString()+"-"+t.toString(),this._lazyPt[t]=s}return this._lazyPt[t]}equalityTest(t){return t===this||t!==null&&t instanceof Ge&&t.getUniqueHash()===this.getUniqueHash()}getUniqueHash(){return this._cacheId.toString()+"-"+this._partId.toString()}};class Se extends J{constructor(t,n,s,r,i){super(t),this._lazyPath=[],this._hasZ=!1,this._hasM=!1,this._hasZ=s,this._hasM=r,this._spRef=n,this._cacheId=i}get(t){if(this._lazyPath[t]===void 0){const n=this._elements[t];if(n===void 0)return;this._lazyPath[t]=new H(n,this._spRef,this._hasZ,this._hasM,this._cacheId,t)}return this._lazyPath[t]}equalityTest(t){return t===this||t!==null&&t instanceof Se&&t.getUniqueHash()===this.getUniqueHash()}getUniqueHash(){return this._cacheId.toString()}}var De,Ze;function fn(e){return Xe.fromJSON(e.toJSON())}function bt(e){return e.toJSON?e.toJSON():e}function dn(e){return e instanceof Date}function yn(e){return e instanceof ae}function pn(e){return e instanceof P}function hn(e){return e instanceof Le}function mn(e){return e instanceof Me}(function(e){e[e.Standardised=0]="Standardised",e[e.StandardisedNoInterval=1]="StandardisedNoInterval",e[e.SqlServer=2]="SqlServer",e[e.Oracle=3]="Oracle",e[e.Postgres=4]="Postgres",e[e.PGDB=5]="PGDB",e[e.FILEGDB=6]="FILEGDB",e[e.NotEvaluated=7]="NotEvaluated"})(De||(De={})),function(e){e[e.InFeatureSet=0]="InFeatureSet",e[e.NotInFeatureSet=1]="NotInFeatureSet",e[e.Unknown=2]="Unknown"}(Ze||(Ze={}));const gn=1e3,bn={point:"point",polygon:"polygon",polyline:"polyline",multipoint:"multipoint",extent:"extent",esriGeometryPoint:"point",esriGeometryPolygon:"polygon",esriGeometryPolyline:"polyline",esriGeometryMultipoint:"multipoint",esriGeometryEnvelope:"extent",envelope:"extent"},Ae={point:"esriGeometryPoint",polygon:"esriGeometryPolygon",polyline:"esriGeometryPolyline",multipoint:"esriGeometryMultipoint",extent:"esriGeometryEnvelope",esriGeometryPoint:"esriGeometryPoint",esriGeometryPolygon:"esriGeometryPolygon",esriGeometryPolyline:"esriGeometryPolyline",esriGeometryMultipoint:"esriGeometryMultipoint",esriGeometryEnvelope:"esriGeometryEnvelope",envelope:"esriGeometryEnvelope"},Sn={"small-integer":"esriFieldTypeSmallInteger",integer:"esriFieldTypeInteger",long:"esriFieldTypeLong",single:"esriFieldTypeSingle",double:"esriFieldTypeDouble",string:"esriFieldTypeString",date:"esriFieldTypeDate","date-only":"esriFieldTypeDateOnly","time-only":"esriFieldTypeTimeOnly","timestamp-offset":"esriFieldTypeTimestampOffset",oid:"esriFieldTypeOID",geometry:"esriFieldTypeGeometry",blob:"esriFieldTypeBlob",raster:"esriFieldTypeRaster",guid:"esriFieldTypeGUID","globalThis-id":"esriFieldTypeGlobalID",xml:"esriFieldTypeXML","big-integer":"esriFieldTypeBigInteger",esriFieldTypeSmallInteger:"esriFieldTypeSmallInteger",esriFieldTypeInteger:"esriFieldTypeInteger",esriFieldTypeLong:"esriFieldTypeLong",esriFieldTypeSingle:"esriFieldTypeSingle",esriFieldTypeDouble:"esriFieldTypeDouble",esriFieldTypeString:"esriFieldTypeString",esriFieldTypeDate:"esriFieldTypeDate",esriFieldTypeDateOnly:"esriFieldTypeDateOnly",esriFieldTypeTimeOnly:"esriFieldTypeTimeOnly",esriFieldTypeTimestampOffset:"esriFieldTypeTimestampOffset",esriFieldTypeOID:"esriFieldTypeOID",esriFieldTypeGeometry:"esriFieldTypeGeometry",esriFieldTypeBlob:"esriFieldTypeBlob",esriFieldTypeRaster:"esriFieldTypeRaster",esriFieldTypeGUID:"esriFieldTypeGUID",esriFieldTypeGlobalID:"esriFieldTypeGlobalID",esriFieldTypeXML:"esriFieldTypeXML",esriFieldTypeBigInteger:"esriFieldTypeBigInteger"};function Tn(e){return e===void 0?"":e=(e=(e=e.replace(/\/featureserver\/[0-9]*/i,"/FeatureServer")).replace(/\/mapserver\/[0-9]*/i,"/MapServer")).split("?")[0]}function Nn(e,t){t||(t={}),typeof t=="function"&&(t={cmp:t});const n=typeof t.cycles=="boolean"&&t.cycles,s=t.cmp&&(r=t.cmp,function(o){return function(a,u){const c={key:a,value:o[a]},d={key:u,value:o[u]};return r(c,d)}});var r;const i=[];return function o(a){if(a?.toJSON&&typeof a.toJSON=="function"&&(a=a.toJSON()),a===void 0)return;if(typeof a=="number")return isFinite(a)?""+a:"null";if(typeof a!="object")return JSON.stringify(a);let u,c;if(Array.isArray(a)){for(c="[",u=0;u<a.length;u++)u&&(c+=","),c+=o(a[u])||"null";return c+"]"}if(a===null)return"null";if(i.includes(a)){if(n)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}const d=i.push(a)-1,p=Object.keys(a).sort(s?.(a));for(c="",u=0;u<p.length;u++){const k=p[u],N=o(a[k]);N&&(c&&(c+=","),c+=JSON.stringify(k)+":"+N)}return i.splice(d,1),"{"+c+"}"}(e)}function St(e){switch(e.type){case"catalog":case"csv":case"feature":case"geojson":case"knowledge-graph-sublayer":case"oriented-imagery":case"subtype-group":case"wfs":return!0;default:return!1}}function wn(e){switch(e.type){case"catalog-footprint":case"subtype-sublayer":return!0;default:return St(e)}}let Tt=class{constructor(t){this.value=t}};class Nt{constructor(t){this.value=t}}const T={type:"VOID"},wt=Symbol("BREAK"),_t=Symbol("CONTINUE");function V(e,t,n){return t===""||t==null||t===n||t===n?e:e=e.split(t).join(n)}function B(e){return e instanceof E}function Te(e){return e instanceof be}function U(e){return!!h(e)||!!S(e)||!!y(e)||!!m(e)||!!g(e)||!!b(e)||e===null||e===T||typeof e=="number"}function Ft(e,t){return e===void 0?t:e}function vt(e){return e==null?"":v(e)||C(e)?"Array":y(e)?"Date":g(e)?"Time":m(e)?"DateOnly":h(e)?"String":b(e)?"Boolean":S(e)?"Number":e?.declaredClass==="esri.arcade.Attachment"?"Attachment":e?.declaredClass==="esri.arcade.Portal"?"Portal":e?.declaredClass==="esri.arcade.Dictionary"?"Dictionary":ve(e)?"KnowledgeGraph":e instanceof be?"Module":K(e)?"Feature":e instanceof q?"Point":e instanceof de?"Polygon":e instanceof ye?"Polyline":e instanceof pe?"Multipoint":e instanceof he?"Extent":B(e)?"Function":we(e)?"FeatureSet":Fe(e)?"FeatureSetCollection":Ne(e)?"Voxel":e===T?"":typeof e=="number"&&isNaN(e)?"Number":"Unrecognized Type"}function xt(e){return e===T}function ne(e){return e instanceof G}function K(e){return e?.arcadeDeclaredClass==="esri.arcade.Feature"}function Ne(e){return e?.arcadeDeclaredClass==="esri.arcade.Voxel"}function we(e){return e?.declaredRootClass==="esri.arcade.featureset.support.FeatureSet"}function _e(e){return e?.declaredClass==="esri.arcade.Dictionary"}function Ot(e){return _e(e)||K(e)||Ne(e)}function Fe(e){return e?.declaredRootClass==="esri.arcade.featureSetCollection"}function ve(e){return e?.declaredClass==="esri.rest.knowledgeGraph.KnowledgeGraph"}function C(e){return e instanceof J}function y(e){return e instanceof P}function m(e){return e instanceof Le}function g(e){return e instanceof Me}function le(e){return e!=null&&typeof e=="object"}function je(e,t,n,s,r){if(e.length<t||e.length>n)throw new _(s,F.WrongNumberOfParameters,r)}function Ct(e){return e<0?-Math.round(-e):Math.round(e)}function xe(e,t){return isNaN(e)||t==null||t===""?e.toString():(t=V(t,"‰",""),t=V(t,"¤",""),pt(e,{pattern:t}))}function re(e,t){return t==null||t===""?e.toISOString(!0):e.toFormat($e(t),{locale:Pe(),numberingSystem:"latn"})}function $e(e,t=!1){e=e.replaceAll(/LTS|LT|L{1,4}|l{1,4}/g,"[$&]");let n="";const s=/(\[[^[]*\])|(\\)?([Hh]mm(ss)?|Mo|M{1,4}|Do|DDDo|D{1,4}|d{2,4}|do?|w[o|w]?|W[o|W]?|Qo?|N{1,5}|YYYYYY|YYYYY|YYYY|YY|y{2,4}|yo?|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|Z{1,5}|.)/g;for(const r of e.match(s)||[])switch(r){case"D":n+="d";break;case"DD":n+="dd";break;case"DDD":n+="o";break;case"d":n+="c";break;case"ddd":n+="ccc";break;case"dddd":n+="cccc";break;case"M":n+="L";break;case"MM":n+="LL";break;case"MMM":n+="LLL";break;case"MMMM":n+="LLLL";break;case"YY":n+="yy";break;case"Y":case"YYYY":n+="yyyy";break;case"Q":n+="q";break;case"Z":n+="Z";break;case"ZZ":n+="ZZ";break;case"ZZZ":n+="ZZZ";break;case"ZZZZ":n+=t?"[ZZZZ]":"ZZZZ";break;case"ZZZZZ":n+=t?"[ZZZZZ]":"ZZZZZ";break;case"S":n+="'S'";break;case"SS":n+="'SS'";break;case"SSS":n+="u";break;case"A":case"a":n+="a";break;case"m":case"mm":case"h":case"hh":case"H":case"HH":case"s":case"ss":case"X":case"x":n+=r;break;default:r.length>=2&&r.slice(0,1)==="["&&r.slice(-1)==="]"?n+=`'${r.slice(1,-1)}'`:n+=`'${r}'`}return n}function l(e,t,n){switch(n){case">":return e>t;case"<":return e<t;case">=":return e>=t;case"<=":return e<=t}return!1}function kt(e,t,n){if(e===null){if(t===null||t===T)return l(null,null,n);if(S(t))return l(0,t,n);if(h(t)||b(t))return l(0,f(t),n);if(y(t))return l(0,t.toNumber(),n);if(g(t)||m(t))return l(e,t.toNumber(),n)}if(e===T){if(t===null||t===T)return l(null,null,n);if(S(t))return l(0,t,n);if(h(t)||b(t))return l(0,f(t),n);if(y(t))return l(0,t.toNumber(),n);if(g(t)||m(t))return l(e,t.toNumber(),n)}else if(S(e)){if(S(t))return l(e,t,n);if(b(t))return l(e,f(t),n);if(t===null||t===T)return l(e,0,n);if(h(t))return l(e,f(t),n);if(y(t)||g(t)||m(t))return l(e,t.toNumber(),n)}else if(h(e)){if(h(t))return l(I(e),I(t),n);if(y(t)||g(t)||m(t))return l(f(e),t.toNumber(),n);if(S(t))return l(f(e),t,n);if(t===null||t===T)return l(f(e),0,n);if(b(t))return l(f(e),f(t),n)}else if(y(e)){if(y(t))return e.timeZone!==t.timeZone&&(e.isUnknownTimeZone?e=P.arcadeDateAndZoneToArcadeDate(e,t.timeZone):t.isUnknownTimeZone&&(t=P.arcadeDateAndZoneToArcadeDate(t,e.timeZone))),l(e.toNumber(),t.toNumber(),n);if(t===null||t===T)return l(e.toNumber(),0,n);if(S(t))return l(e.toNumber(),t,n);if(b(t)||h(t))return l(e.toNumber(),f(t),n);if(g(t))throw new _(null,F.CannotCompareDateAndTime,null);if(m(t))return l(e.toNumber(),t.toNumber(),n)}else if(b(e)){if(b(t))return l(e,t,n);if(S(t))return l(f(e),f(t),n);if(y(t)||g(t)||m(t))return l(f(e),t.toNumber(),n);if(t===null||t===T)return l(f(e),0,n);if(h(t))return l(f(e),f(t),n)}else if(m(e)){if(y(t))return l(e.toNumber(),t.toNumber(),n);if(t===null||t===T)return l(e.toNumber(),0,n);if(S(t))return l(e.toNumber(),t,n);if(b(t)||h(t))return l(e.toNumber(),f(t),n);if(g(t))throw new _(null,F.CannotCompareDateAndTime,null);if(m(t))return l(e.toNumber(),t.toNumber(),n)}else if(g(e)){if(y(t))throw new _(null,F.CannotCompareDateAndTime,null);if(t===null||t===T)return l(e.toNumber(),0,n);if(S(t))return l(e.toNumber(),t,n);if(b(t)||h(t))return l(e.toNumber(),f(t),n);if(g(t))return l(e.toNumber(),t.toNumber(),n);if(m(t))throw new _(null,F.CannotCompareDateAndTime,null)}return!!Re(e,t)&&(n==="<="||n===">=")}function Re(e,t){if(e===t||e===null&&t===T||t===null&&e===T)return!0;if(y(e)&&y(t)||g(e)&&g(t)||m(e)&&m(t))return e.equals(t);if(e instanceof Se||e instanceof H)return e.equalityTest(t);if(e instanceof q&&t instanceof q){const n=e.cache._arcadeCacheId,s=t.cache._arcadeCacheId;if(n!=null)return n===s}return!!(le(e)&&le(t)&&(e._arcadeCacheId===t._arcadeCacheId&&e._arcadeCacheId!==void 0&&e._arcadeCacheId!==null||e._underlyingGraphic===t._underlyingGraphic&&e._underlyingGraphic!==void 0&&e._underlyingGraphic!==null))}function ze(e,{useNumbersForDates:t}){let n="";for(const s in e){n!==""&&(n+=",");const r=e[s];r==null?n+=JSON.stringify(s)+":null":b(r)||S(r)||h(r)?n+=JSON.stringify(s)+":"+JSON.stringify(r):ne(r)?n+=JSON.stringify(s)+":"+z(r):g(r)||m(r)?n+=`${JSON.stringify(s)}:${JSON.stringify(r.toString())}`:C(r)||Array.isArray(r)?n+=JSON.stringify(s)+":"+z(r,null,t):y(r)?n+=t?JSON.stringify(s)+":"+JSON.stringify(r.getTime()):JSON.stringify(s)+":"+r.stringify():r!==null&&typeof r=="object"&&"castToText"in r&&(n+=JSON.stringify(s)+":"+r.castToText(t))}return"{"+n+"}"}function I(e,t){if(h(e))return e;if(e===null)return"";if(S(e))return xe(e,t);if(b(e))return e.toString();if(y(e))return re(e,t);if(g(e)||m(e))return e.toFormat(t);if(e instanceof G)return JSON.stringify(e.toJSON());if(v(e)){const n=[];for(let s=0;s<e.length;s++)n[s]=Q(e[s]);return"["+n.join(",")+"]"}if(e instanceof J){const n=[];for(let s=0;s<e.length();s++)n[s]=Q(e.get(s));return"["+n.join(",")+"]"}return e!==null&&typeof e=="object"&&"castToText"in e?e.castToText():B(e)?"object, Function":e===T?"":Te(e)?"object, Module":""}function Dt(e){const t=[];if(e instanceof J){for(let n=0;n<e.length();n++)t[n]=f(e.get(n));return t}if(!v(e))return null;for(let n=0;n<e.length;n++)t[n]=f(e[n]);return t}function z(e,t,n=!1){if(h(e))return e;if(e===null)return"";if(S(e))return xe(e,t);if(b(e))return e.toString();if(y(e))return re(e,t);if(g(e)||m(e))return e.toFormat(t);if(e instanceof G)return e instanceof he?'{"xmin":'+e.xmin.toString()+',"ymin":'+e.ymin.toString()+","+(e.hasZ?'"zmin":'+e.zmin.toString()+",":"")+(e.hasM?'"mmin":'+e.mmin.toString()+",":"")+'"xmax":'+e.xmax.toString()+',"ymax":'+e.ymax.toString()+","+(e.hasZ?'"zmax":'+e.zmax.toString()+",":"")+(e.hasM?'"mmax":'+e.mmax.toString()+",":"")+'"spatialReference":'+ue(e.spatialReference)+"}":ue(e.toJSON(),(s,r)=>s.key===r.key?0:s.key==="spatialReference"?1:r.key==="spatialReference"||s.key<r.key?-1:s.key>r.key?1:0);if(v(e)){const s=[];for(let r=0;r<e.length;r++)s[r]=Q(e[r],n);return"["+s.join(",")+"]"}if(e instanceof J){const s=[];for(let r=0;r<e.length();r++)s[r]=Q(e.get(r),n);return"["+s.join(",")+"]"}return e!==null&&typeof e=="object"&&"castToText"in e?e.castToText(n):B(e)?"object, Function":e===T?"":Te(e)?"object, Module":""}function Q(e,t=!1){if(e===null)return"null";if(b(e)||S(e)||h(e))return JSON.stringify(e);if(e instanceof G||e instanceof J||Array.isArray(e))return z(e,null,t);if(y(e))return JSON.stringify(t?e.getTime():re(e,""));if(g(e)||m(e))return JSON.stringify(e.toString());if(e!==null&&typeof e=="object"){if("castToText"in e)return e.castToText(t)}else if(e===T)return"null";return"null"}function f(e,t){return S(e)?e:e===null||e===""?0:y(e)||m(e)||g(e)?NaN:b(e)?e?1:0:v(e)||e===""||e===void 0?NaN:t!==void 0&&h(e)?(t=V(t,"‰",""),t=V(t,"¤",""),ht(e,{pattern:t})):e===T?0:Number(e)}function Zt(e,t){if(y(e))return e;if(h(e)){const n=At(e,t);if(n)return P.dateTimeToArcadeDate(n)}return null}function At(e,t){const n=/ (\d\d)/,s=et(t);let r=ae.fromISO(e,{zone:s});return r.isValid||n.test(e)&&(e=e.replace(n,"T$1"),r=ae.fromISO(e,{zone:t}),r.isValid)?r:null}function It(e){return b(e)?e:h(e)?(e=e.toLowerCase())==="true":!!S(e)&&e!==0&&!isNaN(e)}function Jt(e,t){const n=JSON.parse(e);return n&&!n.spatialReference&&(n.spatialReference=t),tt(n)}function Lt(e,t){return e==null?null:(e.spatialReference!==null&&e.spatialReference!==void 0||(e.spatialReference=t),e)}function Mt(e){if(e===null)return null;if(e instanceof q)return e.x==="NaN"||e.x===null||isNaN(e.x)?null:e;if(e instanceof de){if((e.curveRings??e.rings).length===0)return null;for(const t of e.curveRings??e.rings)if(t.length>0)return e;return null}if(e instanceof ye){if((e.curvePaths??e.paths).length===0)return null;for(const t of e.curvePaths??e.paths)if(t.length>0)return e;return null}return e instanceof pe?e.points.length===0?null:e:e instanceof he?e.xmin==="NaN"||e.xmin===null||isNaN(e.xmin)?null:e:null}function qe(e,t){if(!e||!e.domain)return t;let n=null,s=null;if(y(t))n=t.toNumber();else if(m(t))n=t.toString();else if(g(t))n=t.toStorageString();else if(e.field.type==="string"||e.field.type==="esriFieldTypeString")n=I(t);else{if(t==null)return null;if(t==="")return t;n=f(t)}for(let r=0;r<e.domain.codedValues.length;r++){const i=e.domain.codedValues[r];i.code===n&&(s=i)}return s===null?I(t):s.name}function Ue(e,t){if(!e||!e.domain)return t;let n=null;const s=I(t);for(let r=0;r<e.domain.codedValues.length;r++){const i=e.domain.codedValues[r];i.name===s&&(n=i)}return n===null?t:n.code}function se(e,t,n=null,s=null){if(!t||!t.fields)return null;let r,i,o=null;for(let d=0;d<t.fields.length;d++){const p=t.fields[d];p.name.toLowerCase()===e.toString().toLowerCase()&&(o=p)}if(o===null)throw new _(null,F.FieldNotFound,null,{key:e});let a=t.typeIdField,u="id",c=t.types;if(t.subtypeField&&(a=t.subtypeField,u="code",c=t.subtypes??[]),s===null&&n&&a)s=n.hasField(a)?n.field(a):null;else if(a&&s!==null){let d=!1;for(const p of c||[])if(s===p[u]){d=!0;break}if(!d){for(const p of c||[])if(s===p.name){s=p[u],d=!0;break}}d||(s=null,n&&a&&(s=n.hasField(a)?n.field(a):null))}return s!=null&&c.some(d=>d[u]===s&&(r=d.domains?.[o.name],r&&r.type==="inherited"&&(r=Ie(o.name,t),i=!0),!0)),i||r||(r=Ie(e,t)),{field:o,domain:r}}function Ie(e,t){let n;return t.fields.some(s=>(s.name.toLowerCase()===e.toLowerCase()&&(n=s.domain),!!n)),n}function ue(e,t){t||(t={}),typeof t=="function"&&(t={cmp:t});const n=typeof t.cycles=="boolean"&&t.cycles,s=t.cmp&&(r=t.cmp,function(o){return function(a,u){const c={key:a,value:o[a]},d={key:u,value:o[u]};return r(c,d)}});var r;const i=[];return function o(a){if(a?.toJSON&&typeof a.toJSON=="function"&&(a=a.toJSON()),a===void 0)return;if(typeof a=="number")return isFinite(a)?""+a:"null";if(typeof a!="object")return JSON.stringify(a);let u,c;if(Array.isArray(a)){for(c="[",u=0;u<a.length;u++)u&&(c+=","),c+=o(a[u])||"null";return c+"]"}if(a===null)return"null";if(i.includes(a)){if(n)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}const d=i.push(a)-1,p=Object.keys(a).sort(s?.(a));for(c="",u=0;u<p.length;u++){const k=p[u],N=o(a[k]);N&&(c&&(c+=","),c+=JSON.stringify(k)+":"+N)}return i.splice(d,1),"{"+c+"}"}(e)}function Pt(e){if(e===null)return null;const t=[];for(const n of e)K(n)?t.push(n.geometry()):t.push(n);return t}function Y(e,t){if(!(t instanceof q))throw new _(null,F.InvalidParameter,null);e.push(t.hasZ?t.hasM?[t.x,t.y,t.z,t.m]:[t.x,t.y,t.z]:[t.x,t.y])}function Gt(e,t){if(v(e)||C(e)){let n=!1,s=!1,r=[],i=t;if(v(e)){for(const o of e)Y(r,o);r.length>0&&(i=e[0].spatialReference,n=e[0].hasZ,s=e[0].hasM)}else if(e instanceof H)r=e._elements,r.length>0&&(n=e._hasZ,s=e._hasM,i=e.get(0).spatialReference);else{if(!C(e))throw new _(null,F.InvalidParameter,null);for(const o of e.toArray())Y(r,o);r.length>0&&(i=e.get(0).spatialReference,n=e.get(0).hasZ===!0,s=e.get(0).hasM===!0)}return r.length===0?null:(nt(r)||(r=r.slice().reverse()),new de({rings:[r],spatialReference:i,hasZ:n,hasM:s}))}return e}function jt(e,t){if(v(e)||C(e)){let n=!1,s=!1,r=[],i=t;if(v(e)){for(const o of e)Y(r,o);r.length>0&&(i=e[0].spatialReference,n=e[0].hasZ===!0,s=e[0].hasM===!0)}else if(e instanceof H)r=e._elements,r.length>0&&(n=e._hasZ,s=e._hasM,i=e.get(0).spatialReference);else if(C(e)){for(const o of e.toArray())Y(r,o);r.length>0&&(i=e.get(0).spatialReference,n=e.get(0).hasZ===!0,s=e.get(0).hasM===!0)}return r.length===0?null:new ye({paths:[r],spatialReference:i,hasZ:n,hasM:s})}return e}function $t(e,t){if(v(e)||C(e)){let n=!1,s=!1,r=[],i=t;if(v(e)){for(const o of e)Y(r,o);r.length>0&&(i=e[0].spatialReference,n=e[0].hasZ===!0,s=e[0].hasM===!0)}else if(e instanceof H)r=e._elements,r.length>0&&(n=e._hasZ,s=e._hasM,i=e.get(0).spatialReference);else if(C(e)){for(const o of e.toArray())Y(r,o);r.length>0&&(i=e.get(0).spatialReference,n=e.get(0).hasZ===!0,s=e.get(0).hasM===!0)}return r.length===0?null:new pe({points:r,spatialReference:i,hasZ:n,hasM:s})}return e}function ce(e,t=!0){if(e==null)return[];if(v(e)){const n=[];for(const s of e){const r=I(s);(t||r!=="")&&n.push(r)}return n}if(C(e)){const n=[];for(let s=0;s<e.length();s++){const r=I(e.get(s));(t||r!=="")&&n.push(r)}return n}if(U(e)){const n=I(e);if(t||n!=="")return[n]}return[]}let ie=0;function Rt(e){return ie++,ie%100==0?(ie=0,new Promise(t=>{setTimeout(()=>{t(e)},0)})):e}function zt(e,t,n){switch(n){case"&":return e&t;case"|":return e|t;case"^":return e^t;case"<<":return e<<t;case">>":return e>>t;case">>>":return e>>>t}}function R(e,t=null){return e==null?null:b(e)||S(e)||h(e)?e:e instanceof G?t?.keepGeometryType===!0?e:e.toJSON():e instanceof J?e.toArray().map(n=>R(n,t)):Array.isArray(e)?e.map(n=>R(n,t)):W(e)?e:y(e)?e.toJSDate():g(e)?e.toString():m(e)?e.toJSDate():e!==null&&typeof e=="object"&&e.castAsJson!==void 0?e.castAsJson(t):null}async function qt(e,t,n,s,r){const i=await Oe(e,t,n);r[s]=i}async function Oe(e,t=null,n=null){if(e instanceof J&&(e=e.toArray()),e==null)return null;if(U(e)||e instanceof G||W(e)||y(e))return R(e,n);if(Array.isArray(e)){const s=[],r=[];for(const i of e)i===null||U(i)||i instanceof G||W(i)||y(i)?r.push(R(i,n)):(r.push(null),s.push(qt(i,t,n,r.length-1,r)));return s.length>0&&await Promise.all(s),r}return e!==null&&typeof e=="object"&&e.castAsJsonAsync!==void 0?e.castAsJsonAsync(t,n):null}function X(e){return Ye(e)?e.parent:e}function Ye(e){return e&&"declaredClass"in e&&e.declaredClass==="esri.layers.support.SubtypeSublayer"}function Ut(e){return e&&"declaredClass"in e&&e.declaredClass==="esri.layers.SubtypeGroupLayer"}function Yt(e,t,n){const s=X(e.fullSchema());return s===null||!s.fields?null:se(t,s,e,n)}function Bt(e){const t=X(e.fullSchema());return t===null?null:t.fields?t.subtypeField?{subtypeField:t.subtypeField,subtypes:t.subtypes?t.subtypes.map(n=>({name:n.name,code:n.code})):[]}:t.typeIdField?{subtypeField:t.typeIdField,subtypes:t.types?t.types.map(n=>({name:n.name,code:n.id})):[]}:null:null}function Et(e,t,n,s){const r=X(e.fullSchema());if(r===null||!r.fields)return null;const i=se(t,r,e,s);if(n===void 0)try{n=e.field(t)}catch{return null}return qe(i,n)}function Vt(e,t,n,s){const r=X(e.fullSchema());if(r===null||!r.fields)return null;if(n===void 0){try{n=e.field(t)}catch{return null}return n}return Ue(se(t,r,e,s),n)}function Ht(e){return e?.timeZone??"system"}function Kt(e){const t=X(e.fullSchema());if(t===null||!t.fields)return null;const n=[];for(const s of t.fields)n.push(bt(s));return{objectIdField:t.objectIdField,globalIdField:t.globalIdField??"",geometryType:Ae[t.geometryType]===void 0?"":Ae[t.geometryType],fields:n}}function Xt(e,t){const n=P.systemTimeZoneCanonicalName;return e==="system"&&(e=n),{version:Be,engineVersion:rt,timeZone:e,userTimeZone:n,spatialReference:t instanceof st?t.toJSON():t,application:it.applicationName??"",engine:"web",locale:Pe()}}const Be="1.32",Fn=Object.freeze(Object.defineProperty({__proto__:null,ImplicitResult:Nt,ReturnResult:Tt,absRound:Ct,arcadeVersion:Be,autoCastArrayOfPointsToMultiPoint:$t,autoCastArrayOfPointsToPolygon:Gt,autoCastArrayOfPointsToPolyline:jt,autoCastFeatureToGeometry:Pt,binaryOperator:zt,breakResult:wt,castAsJson:R,castAsJsonAsync:Oe,castRecordToText:ze,continueResult:_t,defaultExecutingContext:Xt,defaultTimeZone:Ht,defaultUndefined:Ft,equalityTest:Re,featureDomainCodeLookup:Vt,featureDomainValueLookup:Et,featureFullDomain:Yt,featureSchema:Kt,featureSubtypes:Bt,fixNullGeometry:Mt,fixSpatialReference:Lt,formatDate:re,formatNumber:xe,getDomain:se,getDomainCode:Ue,getDomainValue:qe,getType:vt,greaterThanLessThan:kt,isArray:v,isBoolean:b,isDate:y,isDateOnly:m,isDictionary:_e,isDictionaryLike:Ot,isFeature:K,isFeatureSet:we,isFeatureSetCollection:Fe,isFunctionParameter:B,isGeometry:ne,isGraphic:We,isImmutableArray:C,isInteger:Qe,isJsDate:W,isKnowledgeGraph:ve,isModule:Te,isNumber:S,isObject:le,isSimpleType:U,isString:h,isSubtypeGrouplayer:Ut,isSubtypeSublayer:Ye,isTime:g,isVoid:xt,isVoxel:Ne,multiReplace:V,parseGeometryFromJson:Jt,pcCheck:je,stableStringify:ue,standardiseDateFormat:$e,tick:Rt,toBoolean:It,toDate:Zt,toNumber:f,toNumberArray:Dt,toString:I,toStringArray:ce,toStringExplicit:z,voidOperation:T},Symbol.toStringTag,{value:"Module"}));function vn(e){Ee=e}let Ee;function fe(e){return e===null?null:y(e)?e.clone():U(e)?e:ne(e)?e.clone():C(e)?e.toArray().map(t=>fe(t)):v(e)?e.map(t=>fe(t)):K(e)?Ee.createFromArcadeFeature(e):Fe(e)||we(e)?e:_e(e)||e?.declaredClass==="esri.arcade.Attachment"?e.deepClone():(e?.declaredClass==="esri.arcade.Portal"||ve(e)||e instanceof be||B(e),e)}function ee(e,t,n=!1,s=!1){if(e==null)return null;if(S(e)||b(e)||h(e)||y(e)||m(e)||g(e))return e;if(v(e)){const i=[];for(const o of e)i.push(ee(o,t,n,s));return i}if(s&&ne(e))return e;const r=new Z;r.immutable=!1;for(const[i,o]of Object.entries(e))o!==void 0&&r.setField(i,ee(o,t,n,s));return r.immutable=n,r}class Z{constructor(t){this.declaredClass="esri.arcade.Dictionary",this.plain=!1,this.immutable=!0,t instanceof Z?this.attributes=t.attributes:t==null?this.attributes=Object.create(null):Object.getPrototypeOf(t)!=null?this.attributes={__proto__:null,...t}:this.attributes=t}static containerEntry(t,n){return new Z({__proto__:null,key:t,value:n})}static textFormatting(){const t=new Z({__proto__:null,newline:`
`,tab:"	",singlequote:"'",doublequote:'"',forwardslash:"/",backwardslash:"\\"});return t.immutable=!1,t}field(t){const n=t.toLowerCase(),s=this.attributes[t];if(s!==void 0)return s;for(const r in this.attributes)if(r.toLowerCase()===n)return this.attributes[r];throw new _(null,F.FieldNotFound,null,{key:t})}setField(t,n){if(this.immutable)throw new _(null,F.Immutable,null);if(B(n))throw new _(null,F.NoFunctionInDictionary,null);const s=t.toLowerCase();if(n instanceof Date&&(n=P.dateJSToArcadeDate(n)),this.attributes[t]===void 0){for(const r in this.attributes)if(r.toLowerCase()===s)return void(this.attributes[r]=n);this.attributes[t]=n}else this.attributes[t]=n}hasField(t){const n=t.toLowerCase();if(this.attributes[t]!==void 0)return!0;for(const s in this.attributes)if(s.toLowerCase()===n)return!0;return!1}keys(){let t=[];for(const n in this.attributes)t.push(n);return t=t.sort(),t}castToText(t=!1){return ze(this.attributes,{useNumbersForDates:t})}static convertObjectToArcadeDictionary(t,n,s=!0,r=!1){const i=new Z;i.immutable=!1;for(const o in t){const a=t[o];a!==void 0&&i.setField(o.toString(),ee(a,n,s,r))}return i.immutable=s,i}static convertJsonToArcade(t,n,s=!1,r=!1){return ee(t,n,s,r)}castAsJson(t=null){const n=Object.create(null);for(let s in this.attributes){const r=this.attributes[s];r!==void 0&&(t?.keyTranslate&&(s=t.keyTranslate(s)),n[s]=R(r,t))}return n}async castDictionaryValueAsJsonAsync(t,n,s,r=null,i){const o=await Oe(s,r,i);return t[n]=o,o}async castAsJsonAsync(t=null,n=null){const s=Object.create(null),r=[];for(let i in this.attributes){const o=this.attributes[i];n?.keyTranslate&&(i=n.keyTranslate(i)),o!==void 0&&(U(o)||o instanceof G||o instanceof P?s[i]=R(o,n):r.push(this.castDictionaryValueAsJsonAsync(s,i,o,t,n)))}return r.length>0&&await Promise.all(r),s}deepClone(){const t=new Z;t.immutable=!1;for(const n of this.keys())t.setField(n,fe(this.field(n)));return t}}let A=class extends ge{constructor(e){super(e),this.text=null,this.detectedLanguage="en",this.detectedLanguageScore=-1}};w([x({type:String,json:{write:!0}})],A.prototype,"key",void 0),w([x({type:String,json:{write:!0}})],A.prototype,"text",void 0),w([x({type:String,json:{read:{source:"detectedLanguage.language"},write:{target:"detectedLanguage.language"}}})],A.prototype,"detectedLanguage",void 0),w([x({type:Number,json:{read:{source:"detectedLanguage.score"},write:{target:"detectedLanguage.score"}}})],A.prototype,"detectedLanguageScore",void 0),w([x({type:Object,json:{write:!0}})],A.prototype,"translation",void 0),A=w([me("esri.rest.support.TranslateResult")],A);async function Wt(e,t,n){const s=t.toJSON();s.contents=JSON.stringify(s.contents),s.token=await at(t.portalUrl,t.apiKey,{signal:n?.signal,prompt:n?.authMode!=="no-prompt"});const r=ot(e),i=lt(r.query,{...n,query:s,method:"post",authMode:"anonymous"});return(await ut(r.path,i)).data.results.map(o=>A.fromJSON(o))}let $=class extends ge{constructor(e){super(e)}};w([x({type:String,json:{write:!0}})],$.prototype,"key",void 0),w([x({type:String,json:{write:!0}})],$.prototype,"text",void 0),$=w([me("esri.rest.support.TranslateContent")],$);let D=class extends ge{constructor(e){super(e),this.to=null,this.contents=null,this.portalUrl="https://www.arcgis.com",this.translator="esri",this.from=null,this.apiKey=null,this.requestSource=null}};w([x({type:[String],json:{write:!0}})],D.prototype,"to",void 0),w([x({type:[$],json:{write:!0}})],D.prototype,"contents",void 0),w([x({type:String,json:{write:!0}})],D.prototype,"portalUrl",void 0),w([x({type:String,json:{write:!0,default:"esri"}})],D.prototype,"translator",void 0),w([x({type:String,json:{write:!0}})],D.prototype,"from",void 0),w([x(mt)],D.prototype,"apiKey",void 0),w([x({type:String,json:{name:"x-esri-request-source"}})],D.prototype,"requestSource",void 0),D=w([me("esri.rest.support.TranslateParameters")],D);class Ve{constructor(t,n){this.portal=t,this._debugLog=n}async translate(t){this.portal.loaded||await this.portal.load();const n=this.portal.helperServices?.aiUtilityServices;if(n==null)return{success:!1};const s=n.url+n.translateUtility;try{return t.requestSource??(t.requestSource="arcade"),{success:!0,results:(await Wt(s,t,{authMode:"no-prompt"})).map(r=>r.toJSON())}}catch(r){return this._debugLog!=null&&(r instanceof Error||r instanceof ct)&&this._debugLog(`TranslateText error: ${r.message}`),ft.getLogger("esri.arcade.functions.aiServices").error(r),{success:!1}}}}class Qt{constructor(t,n,s){this._parameters=t,this._maxTotalContentSize=n,this._maxContentsLength=s,this._requests=[],this._normalizedContents=new Map,this._contentsTotalSize=0}tryAdd(t){const n=new Set(t.filter(i=>!this._normalizedContents.has(i.text)).map(i=>i.text));if(this._requests.length+n.size>this._maxContentsLength)return null;let s=0;for(const i of n)s+=i.length;if((s+this._contentsTotalSize)*(this._parameters.to.length??1)>this._maxTotalContentSize)return null;const r=this._requests.length;for(const{key:i,text:o}of t)yt(this._normalizedContents,o,()=>[]).push({batchIdx:r,key:i});return this._requests.push(t),this._contentsTotalSize+=s,r}async send(t){const n=[],s=[];let r=0;for(const[u,c]of this._normalizedContents)n.push(new $({key:String(r++),text:u})),s.push(c);const i=new D(this._parameters);i.contents=n;const o=await t.translate(i);if(!o.success)return Array.from(this._requests,()=>o);const a=Array.from(this._requests,()=>({success:!0,results:[]}));for(const u of o.results){const c=Number(u.key);for(const d of s[c])a[d.batchIdx].results.push({...u,key:d.key})}return a}}function te(e){const t=[...new Set(e.to)].sort(),n=e.from??null,s=e.portalUrl,r=e.translator,i=e.apiKey??null;return JSON.stringify([t,n,s,r,i])}async function Je(e,t,n){try{return(await e.yieldFor(n))[t]}catch{return{success:!1}}}class en{constructor(t,n,{maxTotalContentSize:s=5e4,maxContentsLength:r=1e3}={}){this._executor=t,this._service=n,this._openBatches=new Map,this._maxTotalContentSize=s,this._maxContentsLength=r}create(t){return{translate:async n=>{const s=te(n),{contents:r,to:i,from:o,translator:a,portalUrl:u,apiKey:c}=n;if(i==null)return{success:!1};if(r==null||r.every(N=>N.text.length===0))return{success:!1};const d=this._openBatches.get(s);if(d!=null){const N=d.data.tryAdd(r);if(N!=null)return await Je(t,N,d);d.send()}const p=new Qt({to:i,from:o,translator:a,portalUrl:u,apiKey:c},this._maxTotalContentSize,this._maxContentsLength),k=p.tryAdd(r);if(k!=null){const N=this._executor.openBatch(p,{open:j=>{this._openBatches.set(s,j)},execute:j=>j.send(this._service),close:j=>{this._openBatches.get(s)===j&&this._openBatches.delete(s)}});return await Je(t,k,N)}return await this._service.translate(n)}}}}function tn(e){e.mode==="async"&&(e.functions[gt("TranslateText")]=function(t,n){return e.standardFunctionAsync(t,n,async(s,r,i)=>{if(je(i,2,3,s,r),!h(i[0])&&!v(i[0])&&!C(i[0]))throw new _(s,F.InvalidParameter,r);const o=ce(i[0]);if(!h(i[1])&&!v(i[1])&&!C(i[1]))throw new _(s,F.InvalidParameter,r);const a=ce(i[1]);let u=null;if(i.length>=3){if(!h(i[2]))throw new _(s,F.InvalidParameter,r);u=i[2]}const c=o.map((L,O)=>new $({key:String(O),text:L})),d=s.services?.portal??dt.getDefault(),p=new D({to:a,contents:c,from:u,portalUrl:d.restUrl.replace(/\/sharing\/rest$/,"")}),k=new Map;let N=null;if(s.lrucache!=null){const L=s.lrucache;N??(N=te(p)),p.contents=p.contents?.filter(O=>{const M=L.getCachedTranslation(N,O.text);return M==null||(k.set(O.key,{...M,key:O.key,text:O.text}),!1)})}if(p.contents?.length){const L=s.services?.translation??new Ve(d,s.console),O=await L.translate(p);if(!O.success)return new Z({__proto__:null,success:!1});for(const M of O.results){const Ce=p.contents?.find(He=>He.key===M.key)?.text;if(Ce==null)throw new _(null,F.NeverReach,null);k.set(M.key,M),s.lrucache!=null&&(N??(N=te(p)),s.lrucache.setCachedTranslation(N,Ce,{detectedLanguage:M.detectedLanguage,translation:M.translation}))}}const j=Array.from(c,L=>{const O=A.fromJSON(k.get(L.key));if(O==null)throw new _(null,F.NeverReach,null);return O.text=L.text,Z.convertJsonToArcade(O.toJSON(),s.timeZone??"system",!0)});return new Z({__proto__:null,success:!0,results:j})})})}const xn=Object.freeze(Object.defineProperty({__proto__:null,BatchTranslationServiceFactory:en,PortalTranslationService:Ve,getTranslateParametersKey:te,registerFunctions:tn},Symbol.toStringTag,{value:"Module"}));export{K as $,ce as A,wn as B,fn as C,Pt as D,Yt as E,se as F,B as G,ne as H,T as I,Bt as J,we as K,V as L,Et as M,f as N,qe as O,wt as P,Ot as Q,Vt as R,en as S,tn as T,xt as U,Ue as V,z as W,Fe as X,_t as Y,Kt as Z,Nt as _,xn as a,Sn as a0,ve as a1,_e as a2,Lt as a3,Gt as a4,jt as a5,$t as a6,De as a7,dn as a8,yn as a9,Xt as aA,Fn as aB,mn as aa,pn as ab,hn as ac,bn as ad,Ze as ae,bt as af,Ae as ag,Rt as ah,gn as ai,Nn as aj,Tn as ak,St as al,Ye as am,H as an,Se as ao,ze as ap,U as aq,R as ar,vn as as,fe as at,vt as au,$e as av,Ct as aw,Mt as ax,Ne as ay,Dt as az,C as b,je as c,Re as d,ln as e,ke as f,Ve as g,be as h,zt as i,Z as j,g as k,m as l,kt as m,an as n,Zt as o,I as p,Ht as q,E as r,oe as s,gt as t,y as u,Tt as v,te as w,Ft as x,It as y,J as z};
