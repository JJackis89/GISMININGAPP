import{g6 as X,iN as Y,as as F,aI as ee,iO as U,aR as R,g7 as q,L as te,d2 as ie,cJ as k,a9 as S,iP as ne,az as se,cP as Z,b2 as E,b4 as re,au as ae,iQ as oe,aP as le,cw as D,_ as pe,p as ue,bd as $,l as _,r as s,bf as f,bg as w,m as o,a as g,iR as L,al as T,fK as me}from"./index-8ee34b61.js";import{R as ye}from"./normalizeUtils-0f48385e.js";import{t as J}from"./json-48e3ea08.js";const j=[0,0];function V(e,t){if(!t)return null;if("x"in t){const i={x:0,y:0};return[i.x,i.y]=e(t.x,t.y,j),t.z!=null&&(i.z=t.z),t.m!=null&&(i.m=t.m),i}if("xmin"in t){const i={xmin:0,ymin:0,xmax:0,ymax:0};return[i.xmin,i.ymin]=e(t.xmin,t.ymin,j),[i.xmax,i.ymax]=e(t.xmax,t.ymax,j),t.hasZ&&(i.zmin=t.zmin,i.zmax=t.zmax,i.hasZ=!0),t.hasM&&(i.mmin=t.mmin,i.mmax=t.mmax,i.hasM=!0),i}return"rings"in t?{rings:O(t.rings,e),hasM:t.hasM,hasZ:t.hasZ}:"paths"in t?{paths:O(t.paths,e),hasM:t.hasM,hasZ:t.hasZ}:"points"in t?{points:C(t.points,e),hasM:t.hasM,hasZ:t.hasZ}:null}function O(e,t){const i=[];for(const n of e)i.push(C(n,t));return i}function C(e,t){const i=[];for(const n of e){const r=t(n[0],n[1],[0,0]);i.push(r),n.length>2&&r.push(n[2]),n.length>3&&r.push(n[3])}return i}async function K(e,t){if(!e||!t)return;const i=Array.isArray(e)?e.map(n=>n.geometry!=null?n.geometry.spatialReference:null).filter(te):[e];await ie(i.map(n=>({source:n,dest:t})))}const Q=V.bind(null,X),W=V.bind(null,Y);function G(e,t,i,n){if(!e)return null;if(i||(i=t,t=e.spatialReference),!k(t)||!k(i)||F(t,i))return e;if(U(t,i)){const r=R(i)?Q(e):W(e);return r.spatialReference=i,r}return q(J,[e],t,i,null,n)[0]}class ce{constructor(){this._jobs=[],this._timer=null,this._process=this._process.bind(this)}async push(t,i,n,r){if(!t?.length||!i||!n||F(i,n))return t;const l={geometries:t,inSpatialReference:i,outSpatialReference:n,geographicTransformation:r,resolve:ee()};return this._jobs.push(l),this._timer??(this._timer=setTimeout(this._process,10)),l.resolve.promise}_process(){this._timer=null;const t=this._jobs.shift();if(!t)return;const{geometries:i,inSpatialReference:n,outSpatialReference:r,resolve:l,geographicTransformation:u}=t;U(n,r)?R(r)?l(i.map(Q)):l(i.map(W)):l(q(J,i,n,r,u,null)),this._jobs.length>0&&(this._timer=setTimeout(this._process,10))}}const de=new ce;function ke(e,t,i,n){return de.push(e,t,i,n)}const fe=new S({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"}),M=Object.freeze({}),he="frequency";async function De(e,t,i){const n=e.bin;return n.onField&&(n.onField=n.onField.trim()),n.onExpression?.value&&(n.onExpression.value=n.onExpression.value.trim()),n.splitBy&&(n.splitBy.value&&(n.splitBy.value=n.splitBy.value.trim()),n.splitBy.outAlias&&(n.splitBy.outAlias=n.splitBy.outAlias.trim())),n.stackBy&&(n.stackBy.value&&(n.stackBy.value=n.stackBy.value.trim()),n.stackBy.outAlias&&(n.stackBy.outAlias=n.stackBy.outAlias.trim())),"normalizationField"in n.parameters&&n.parameters.normalizationField&&(n.parameters.normalizationField=n.parameters.normalizationField.trim()),e.outStatistics?.length||(e.outStatistics=[{statisticType:"count",onStatisticField:"1",outStatisticFieldName:he}]),ve(e,t,i)}async function ve(e,t,i){const{outFields:n,orderByFields:r,groupByFieldsForStatistics:l,outStatistics:u}=e;if(n)for(let a=0;a<n.length;a++)n[a]=n[a].trim();if(r)for(let a=0;a<r.length;a++)r[a]=r[a].trim();if(l)for(let a=0;a<l.length;a++)l[a]=l[a].trim();if(u)for(let a=0;a<u.length;a++)u[a].onStatisticField&&(u[a].onStatisticField=u[a].onStatisticField.trim());return e.geometry&&!e.outSR&&(e.outSR=e.geometry.spatialReference),ge(e,t,i)}async function ge(e,t,i){if(!e)return null;let{where:n}=e;if(e.where=n=n?.trim(),(!n||/^1 *= *1$/.test(n)||t&&t===n)&&(e.where=null),!e.geometry)return e;let r=await we(e);if(e.distance=0,e.units=null,e.spatialRel==="esriSpatialRelEnvelopeIntersects"){const{spatialReference:l}=e.geometry;r=ne(r),r.spatialReference=l}if(r){await K(r.spatialReference,i),r=xe(r,i);const l=(await ye(se(r)))[0];if(l==null)throw M;const u="quantizationParameters"in e&&e.quantizationParameters?.tolerance||"maxAllowableOffset"in e&&e.maxAllowableOffset||0,a=u&&H(r,i)?{densificationStep:8*u}:void 0,h=l.toJSON(),b=G(h,h.spatialReference,i,a);if(!b)throw M;b.spatialReference=i,e.geometry=b}return e}function H(e,t){if(!e)return!1;const i=e.spatialReference;return(Z(e)||E(e)||re(e))&&!F(i,t)&&!ae(i,t)}function xe(e,t){const i=e.spatialReference;return H(e,t)&&Z(e)?{spatialReference:i,rings:[[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]]}:e}async function we(e){const{distance:t,units:i}=e,n=e.geometry;if(t==null||"vertexAttributes"in n)return n;const r=n.spatialReference,l=i?fe.fromJSON(i):oe(r),u=r&&(le(r)||R(r))?n:await K(r,D).then(()=>G(n,D)),a=await pe(()=>import("./geodesicBufferOperator-bbd95f84.js"),["assets/geodesicBufferOperator-bbd95f84.js","assets/index-8ee34b61.js","assets/index-a5714ce2.css","assets/operatorGeodesicBuffer-f970894a.js","assets/SimpleGeometryCursor-e3941f41.js","assets/geodeticCurveType-07cde097.js"]);await a.load();const h=a.execute(u,t||1,{unit:l})??void 0;if(!h||!E(h)||h.rings.length===0)throw new ue("unsupported-query:invalid-parameters","Invalid parameters for query by distance");return h}function Oe(e,t){return e==null?null:typeof e=="string"?t?new Date(`1970-01-01T${e}Z`).getTime():new Date(e).getTime():e instanceof Date?e.getTime():e}const Be=new S({esriFieldTypeInteger:"integer",esriFieldTypeString:"string"});let y=class extends $.ClonableMixin(_){constructor(t){super(t),this.alias=null,this.responseType=null,this.type=null,this.value=null,this.valueType=null}};s([o({type:String,json:{name:"outAlias",write:!0}})],y.prototype,"alias",void 0),s([o({type:String})],y.prototype,"responseType",void 0),s([o({type:String,json:{write:!0}})],y.prototype,"type",void 0),s([o({type:String,json:{write:!0}})],y.prototype,"value",void 0),s([f(Be)],y.prototype,"valueType",void 0),y=s([g("esri.rest.support.AttributeBinsGrouping")],y);const B=y;y.from=w(y);const Se=new S({esriFieldTypeSmallInteger:"small-integer",esriFieldTypeInteger:"integer",esriFieldTypeSingle:"single",esriFieldTypeDouble:"double",esriFieldTypeLong:"long",esriFieldTypeDate:"date",esriFieldTypeDateOnly:"date-only",esriFieldTypeTimeOnly:"time-only",esriFieldTypeTimestampOffset:"timestamp-offset"}),Te=new S({naturalLog:"natural-log",squareRoot:"square-root"});let p=class extends $.ClonableMixin(_){constructor(e){super(e),this.expression=null,this.expressionValueType=null,this.field=null,this.firstDayOfWeek=null,this.hideUpperBound=null,this.splitBy=null,this.stackBy=null,this.transformation=null}};s([o({type:String,json:{name:"onExpression.value",write:!0}})],p.prototype,"expression",void 0),s([f(Se,{name:"onExpression.valueType"})],p.prototype,"expressionValueType",void 0),s([o({type:String,json:{name:"onField",write:!0}})],p.prototype,"field",void 0),s([o({type:String,json:{write:!0}})],p.prototype,"firstDayOfWeek",void 0),s([o({type:String,json:{write:!0}})],p.prototype,"hideUpperBound",void 0),s([o({type:B,json:{write:{overridePolicy(){return{enabled:this.splitBy?.value!=null||this.splitBy?.type!=null}}}}})],p.prototype,"splitBy",void 0),s([o({type:B,json:{write:{target:{stackBy:{type:B},jsonStyle:{type:String}},writer:(e,t)=>{e&&(t.stackBy=e.toJSON(),e.responseType!=null&&(t.jsonStyle=e.responseType))},overridePolicy(){return{enabled:this.stackBy?.value!=null||this.stackBy?.type!=null}}},read:{source:["stackBy","jsonStyle"],reader:(e,t)=>B.fromJSON({...t.stackBy,responseType:t.jsonStyle})}}})],p.prototype,"stackBy",void 0),s([f(Te)],p.prototype,"transformation",void 0),p=s([g("esri.rest.support.BinParametersBase")],p);function z(e,t,i){T(i,e instanceof Date?e.getTime():e,t)}let c=class extends L(p){constructor(t){super(t),this.numBins=null,this.end=null,this.start=null,this.type="auto-interval"}};s([o({type:Number,json:{name:"parameters.numberOfBins",write:!0}})],c.prototype,"numBins",void 0),s([o({json:{name:"parameters.end",write:{writer:z}}})],c.prototype,"end",void 0),s([o({json:{name:"parameters.start",write:{writer:z}}})],c.prototype,"start",void 0),s([f({autoIntervalBin:"auto-interval"},{readOnly:!0})],c.prototype,"type",void 0),c=s([g("esri.rest.support.AutoIntervalBinParameters")],c),c.from=w(c);const be=me()({year:"years",quarter:"quarters",month:"months",week:"weeks",day:"days",hour:"hours",minute:"minutes",second:"seconds"});let v=class extends $.ClonableMixin(_){constructor(t){super(t),this.value=null,this.unit=null}};s([o({type:Number,json:{name:"number",write:!0}})],v.prototype,"value",void 0),s([f(be)],v.prototype,"unit",void 0),v=s([g("esri.rest.support.DateBinTimeInterval")],v);const A=v;v.from=w(v);function I(e,t,i){T(i,typeof e=="string"?e:e?.getTime(),t)}function P(e,t){const i=e.parameters[t];return i?typeof i=="string"?i:new Date(i):null}let m=class extends p{constructor(t){super(t),this.end=null,this.interval=null,this.offset=null,this.returnFullIntervalBin=!1,this.start=null,this.snapToData=null,this.type="date"}};s([o({cast:e=>e!=null?typeof e=="string"?e:new Date(e):null,json:{name:"parameters.end",read:{reader:(e,t)=>P(t,"end")},write:{writer:I}}})],m.prototype,"end",void 0),s([o({type:A,json:{name:"parameters",write:!0}})],m.prototype,"interval",void 0),s([o({type:A,json:{name:"parameters.offset",write:!0}})],m.prototype,"offset",void 0),s([o({type:Boolean,json:{name:"parameters.returnFullIntervalBin",write:!0}})],m.prototype,"returnFullIntervalBin",void 0),s([o({cast:e=>e!=null?typeof e=="string"?e:new Date(e):null,json:{name:"parameters.start",read:{reader:(e,t)=>P(t,"start")},write:{writer:I}}})],m.prototype,"start",void 0),s([o({type:String,json:{name:"parameters.snapToData",write:!0}})],m.prototype,"snapToData",void 0),s([f({dateBin:"date"},{readOnly:!0})],m.prototype,"type",void 0),m=s([g("esri.rest.support.DateBinParameters")],m),m.from=w(m);function je(e){return e[0]instanceof Date}function Fe(e,t,i){T(i,e&&je(e)?e.map(n=>n.getTime()):e,t)}let x=class extends p{constructor(t){super(t),this.boundaries=[],this.type="fixed-boundaries"}};s([o({json:{name:"parameters.boundaries",write:{writer:Fe}}})],x.prototype,"boundaries",void 0),s([f({fixedBoundariesBin:"fixed-boundaries"},{readOnly:!0})],x.prototype,"type",void 0),x=s([g("esri.rest.support.FixedBoundariesBinParameters")],x),x.from=w(x);function N(e,t,i){T(i,e instanceof Date?e.getTime():e,t)}let d=class extends L(p){constructor(e){super(e),this.end=null,this.interval=null,this.start=null,this.type="fixed-interval"}};s([o({json:{name:"parameters.end",write:{writer:N}}})],d.prototype,"end",void 0),s([o({type:Number,json:{name:"parameters.interval",write:!0}})],d.prototype,"interval",void 0),s([o({json:{name:"parameters.start",write:{writer:N}}})],d.prototype,"start",void 0),s([f({fixedIntervalBin:"fixed-interval"},{readOnly:!0})],d.prototype,"type",void 0),d=s([g("esri.rest.support.FixedIntervalBinParameters")],d),d.from=w(d);export{ge as B,M as S,m as a,d as b,ve as c,ke as d,fe as g,Oe as h,G as j,c as m,x as n,be as s,De as w,K as x,p as y};
