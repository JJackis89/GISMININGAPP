import{r as a,m as s,eA as m,a as I,l as b,hk as j,hl as g,H as f}from"./index-8ee34b61.js";import{t as x}from"./query-769e0ffd.js";import"./normalizeUtils-0f48385e.js";import"./normalizeUtilsCommon-676995ec.js";import"./pbfQueryUtils-926ff7f8.js";import"./pbf-7aa9e413.js";import"./memoryEstimations-95fc020c.js";import"./OptimizedFeature-eb8a9ca3.js";import"./OptimizedFeatureSet-5dc8ee29.js";function v(e){const{exifInfo:t,exifName:o,tagName:i}=e;if(!t||!o||!i)return null;const n=t.find(d=>d.name===o);return n?O({tagName:i,tags:n.tags}):null}function O(e){const{tagName:t,tags:o}=e;return!o||!t?null:o.find(n=>n.name===t)?.value||null}var u;const k={1:{id:1,rotation:0,mirrored:!1},2:{id:2,rotation:0,mirrored:!0},3:{id:3,rotation:180,mirrored:!1},4:{id:4,rotation:180,mirrored:!0},5:{id:5,rotation:-90,mirrored:!0},6:{id:6,rotation:90,mirrored:!1},7:{id:7,rotation:90,mirrored:!0},8:{id:8,rotation:-90,mirrored:!1}};let r=u=class extends b{constructor(e){super(e),this.contentType=null,this.exifInfo=null,this.id=null,this.globalId=null,this.keywords=null,this.name=null,this.parentGlobalId=null,this.parentObjectId=null,this.size=null,this.url=null}get orientationInfo(){const{exifInfo:e}=this,t=v({exifName:"Exif IFD0",tagName:"Orientation",exifInfo:e});return k[t]||null}clone(){return new u({contentType:this.contentType,exifInfo:this.exifInfo,id:this.id,globalId:this.globalId,keywords:this.keywords,name:this.name,parentGlobalId:this.parentGlobalId,parentObjectId:this.parentObjectId,size:this.size,url:this.url})}};a([s({type:String})],r.prototype,"contentType",void 0),a([s()],r.prototype,"exifInfo",void 0),a([s({readOnly:!0})],r.prototype,"orientationInfo",null),a([s({type:m})],r.prototype,"id",void 0),a([s({type:String})],r.prototype,"globalId",void 0),a([s({type:String})],r.prototype,"keywords",void 0),a([s({type:String})],r.prototype,"name",void 0),a([s({json:{read:!1}})],r.prototype,"parentGlobalId",void 0),a([s({json:{read:!1}})],r.prototype,"parentObjectId",void 0),a([s({type:m})],r.prototype,"size",void 0),a([s({json:{read:!1}})],r.prototype,"url",void 0),r=u=a([I("esri.rest.query.support.AttachmentInfo")],r);function $(e){const t=e.toJSON();return t.attachmentTypes&&(t.attachmentTypes=t.attachmentTypes.join(",")),t.keywords&&(t.keywords=t.keywords.join(",")),t.globalIds&&(t.globalIds=t.globalIds.join(",")),t.objectIds&&(t.objectIds=t.objectIds.join(",")),t.size&&(t.size=t.size.join(",")),t.orderByFields&&(t.orderByFields=t.orderByFields.join(",")),t}function B(e,t){const o={};for(const i of t){const{parentObjectId:n,parentGlobalId:d,attachmentInfos:p}=i;for(const l of p){const{id:h}=l,y=j(g(`${e.path}/${n}/attachments/${h}`)),c=r.fromJSON(l);c.set({url:y,parentObjectId:n,parentGlobalId:d}),o[n]?o[n].push(c):o[n]=[c]}}return o}function J(e,t,o){let i={query:x({...e.query,f:"json",...$(t)})};return o&&(i={...o,...i,query:{...o.query,...i.query}}),f(e.path+"/queryAttachments",i).then(n=>n.data.attachmentGroups)}async function Q(e,t,o){const{objectIds:i}=t,n=[];for(const d of i)n.push(f(e.path+"/"+d+"/attachments",o));return Promise.all(n).then(d=>i.map((p,l)=>({parentObjectId:p,attachmentInfos:d[l].data.attachmentInfos})))}export{J as executeAttachmentQuery,Q as fetchAttachments,B as processAttachmentQueryResult};
