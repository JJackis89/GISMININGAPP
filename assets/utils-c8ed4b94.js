import{bZ as s,gw as g,gx as C,gy as h,gz as b,gA as P,gB as L,bw as $,eG as y,gC as p,gD as z,gE as E,gF as x,_ as F}from"./index-8ee34b61.js";function _(o){const r=[];return k(g(o),r),r.length?new s(L(r[0])):null}function k(o,r){if(!o)return;let l;l=o.type==="CIMTextSymbol"?o.symbol:o;const n=o.type==="CIMPolygonSymbol";if(l?.symbolLayers){for(const e of l.symbolLayers)if(!(e.colorLocked||n&&(C(e)||h(e)&&e.markerPlacement&&b(e.markerPlacement))))switch(e.type){case"CIMPictureMarker":case"CIMPictureStroke":case"CIMPictureFill":e.tintColor&&m(r,e.tintColor);break;case"CIMVectorMarker":e.markerGraphics?.forEach(t=>{k(t.symbol,r)});break;case"CIMSolidStroke":case"CIMSolidFill":m(r,e.color);break;case"CIMGradientFill":j(r,e);break;case"CIMHatchFill":k(e.lineSymbol,r)}}}function m(o,r){for(const l of o)if(l.join(".")===r.join("."))return;o.push(r)}function j(o,r){switch(r.colorRamp?.type){case"CIMMultipartColorRamp":r.colorRamp.colorRamps?.forEach(n=>{n.type==="CIMLinearContinuousColorRamp"&&d(o,n)});break;case"CIMLinearContinuousColorRamp":case"CIMPolarContinuousColorRamp":d(o,r.colorRamp)}}function d(o,r){r&&(r.fromColor&&m(o,r.fromColor),r.toColor&&m(o,r.toColor))}function K(o,r,l){r instanceof s||(r=new s(r));const n=g(o);n&&w(n,r,l)}function w(o,r,l){if(!o)return;let n;n=o.type==="CIMTextSymbol"?o.symbol:o;const e=n?.type==="CIMPolygonSymbol";if(n?.symbolLayers)for(const t of n.symbolLayers){if(t.colorLocked)continue;if(e){if(l){const{layersToColor:c}=l;if((C(t)||h(t)&&t.markerPlacement&&b(t.markerPlacement))&&c==="fill"||P(t)&&c==="outline")continue}else if(C(t)||h(t)&&t.markerPlacement&&b(t.markerPlacement))continue}const i=r.toArray();switch(t.type){case"CIMPictureMarker":case"CIMPictureStroke":case"CIMPictureFill":t.tintColor=i;break;case"CIMVectorMarker":t.markerGraphics?.forEach(c=>{w(c.symbol,r,l)});break;case"CIMSolidStroke":case"CIMSolidFill":t.color=i;break;case"CIMGradientFill":v(t,r);break;case"CIMHatchFill":w(t.lineSymbol,r,l)}}}function v(o,r){switch(o.colorRamp?.type){case"CIMMultipartColorRamp":o.colorRamp.colorRamps?.forEach(n=>{n.type==="CIMLinearContinuousColorRamp"&&I(n,r)});break;case"CIMLinearContinuousColorRamp":case"CIMPolarContinuousColorRamp":I(o.colorRamp,r)}}function I(o,r){if(o&&(o.fromColor&&(o.fromColor=r.toArray()),o.toColor)){const l=r.clone();l.a=0,o.toColor=l.toArray()}}new $(1e3);new s([128,128,128]);const A=new s("white");function Q(o,r){if(!o)return null;let l=null;return y(o)?l=G(o):p(o)&&(l=o.type==="cim"?_(o):o.color?new s(o.color):null),l?f(l,r):null}function G(o){const r=o.symbolLayers;if(!r)return null;let l=null;return r.forEach(n=>{n.type==="object"&&n.resource?.href||(l=n.type==="water"?n.color:n.material?n.material.color:null)}),l?new s(l):null}function f(o,r){if(r==null||o==null)return o;const l=o.toRgba();return l[3]=l[3]*r,new s(l)}function T(o,r,l){const n=o.symbolLayers;if(!n)return;const e=t=>f(r??t??(l!=null?A:null),l);n.forEach(t=>{if(t.type!=="object"||!t.resource?.href||r)if(t.type==="water")t.color=e(t.color);else{const i=t.material!=null?t.material.color:null,c=e(i);if(t.material==null?t.material=new z({color:c}):t.material.color=c,l!=null&&"outline"in t&&t.outline?.color!=null&&(t.outline.color=f(t.outline.color,l)),"marker"in t&&t.marker!=null){const a=e(t.marker.color);t.marker.color=a}}})}function D(o,r,l){(r=r??o.color)&&(o.color=f(r,l)),l!=null&&"outline"in o&&o.outline?.color&&(o.outline.color=f(o.outline.color,l))}function W(o,r,l){o&&(r||l!=null)&&(r&&(r=new s(r)),y(o)?T(o,r,l):p(o)&&D(o,r,l))}async function O(o,r){const l=o.symbolLayers;l&&await E(l,async n=>V(n,r))}async function V(o,r){switch(o.type){case"extrude":B(o,r);break;case"icon":case"line":case"text":H(o,r);break;case"path":N(o,r);break;case"object":await J(o,r)}}function H(o,r){const l=S(r);l!=null&&(o.size=l)}function S(o){for(const r of o)if(typeof r=="number")return r;return null}function B(o,r){const l=r[2];typeof l=="number"&&(o.size=l)}async function J(o,r){const{resourceSize:l,symbolSize:n}=await U(o),e=R(r,l,n);e!=null&&(o.width=u(r[0],n[0],l[0],e),o.depth=u(r[1],n[1],l[1],e),o.height=u(r[2],n[2],l[2],e))}function N(o,r){const l=R(r,x,[o.width,void 0,o.height]);l!=null&&(o.width=u(r[0],o.width,1,l),o.height=u(r[2],o.height,1,l))}function R(o,r,l){for(let n=0;n<3;n++){const e=o[n];switch(e){case"symbol-value":{const t=l[n];return t!=null?t/r[n]:1}case"proportional":break;default:if(e&&r[n])return e/r[n]}}return null}async function U(o){const{computeObjectLayerResourceSize:r}=await F(()=>import("./symbolLayerUtils-19e68e36.js"),["assets/symbolLayerUtils-19e68e36.js","assets/index-8ee34b61.js","assets/index-a5714ce2.css"]),l=await r(o,10),{width:n,height:e,depth:t}=o,i=[n,t,e];let c=1;for(let a=0;a<3;a++){const M=i[a];if(M!=null){c=M/l[a];break}}for(let a=0;a<3;a++)i[a]==null&&(i[a]=l[a]*c);return{resourceSize:l,symbolSize:i}}function u(o,r,l,n){switch(o){case"proportional":return l*n;case"symbol-value":return r??l;default:return o}}function Z(o,r){const l=S(r);if(l!=null)switch(o.type){case"simple-marker":o.size=l;break;case"picture-marker":{const n=o.width/o.height;n>1?(o.width=l,o.height=l*n):(o.width=l*n,o.height=l);break}case"simple-line":o.width=l;break;case"text":o.font.size=l}}async function X(o,r){if(o&&r)return y(o)?O(o,r):void(p(o)&&Z(o,r))}function Y(o,r,l){if(o&&r!=null)if(y(o)){const n=o.symbolLayers;n&&n.forEach(e=>{if(e.type==="object")switch(l){case"tilt":e.tilt=(e.tilt??0)+r;break;case"roll":e.roll=(e.roll??0)+r;break;default:e.heading=(e.heading??0)+r}e.type==="icon"&&(e.angle+=r)})}else p(o)&&(o.type!=="simple-marker"&&o.type!=="picture-marker"&&o.type!=="text"||(o.angle+=r))}export{W as L,X as M,Y as N,K as k,Q as w};
